(()=>{"use strict";var t=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array;function e(){var t=new i(16);return i!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function o(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s(t,i,e){var o=i[0],s=i[1],n=i[2],a=i[3],r=i[4],h=i[5],c=i[6],l=i[7],u=i[8],d=i[9],g=i[10],p=i[11],m=i[12],f=i[13],w=i[14],_=i[15],x=e[0],b=e[1],T=e[2],v=e[3];return t[0]=x*o+b*r+T*u+v*m,t[1]=x*s+b*h+T*d+v*f,t[2]=x*n+b*c+T*g+v*w,t[3]=x*a+b*l+T*p+v*_,x=e[4],b=e[5],T=e[6],v=e[7],t[4]=x*o+b*r+T*u+v*m,t[5]=x*s+b*h+T*d+v*f,t[6]=x*n+b*c+T*g+v*w,t[7]=x*a+b*l+T*p+v*_,x=e[8],b=e[9],T=e[10],v=e[11],t[8]=x*o+b*r+T*u+v*m,t[9]=x*s+b*h+T*d+v*f,t[10]=x*n+b*c+T*g+v*w,t[11]=x*a+b*l+T*p+v*_,x=e[12],b=e[13],T=e[14],v=e[15],t[12]=x*o+b*r+T*u+v*m,t[13]=x*s+b*h+T*d+v*f,t[14]=x*n+b*c+T*g+v*w,t[15]=x*a+b*l+T*p+v*_,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,i=arguments.length;i--;)t+=arguments[i]*arguments[i];return Math.sqrt(t)});var n;class a{static createShader(t,i,e){const o=t.createShader(i);if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(o);throw new Error("Shader compilation error: "+i)}return o}static createProgram(t,i,e){const o=t.createProgram();if(t.attachShader(o,i),t.attachShader(o,e),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){const i=t.getProgramInfoLog(o);throw new Error("Could not compile WebGL program:"+i)}return o}static createBuffer(t,i,e){if(0==e.length)return null;if(!(e&&e.buffer instanceof ArrayBuffer&&void 0!==e.byteLength))return console.warn("Data is not an instance of ArrayBuffer"),null;const o=t.createBuffer();return t.bindBuffer(i,o),t.bufferData(i,e,t.STATIC_DRAW),o}static createVAO(t,...i){if(!(t instanceof WebGL2RenderingContext))return;const e=t.createVertexArray();let o,s;t.bindVertexArray(e);for(let e of i)null!=e.loc&&null!=e.loc&&(t.enableVertexAttribArray(e.loc),o=e.dimension,s=t.FLOAT,t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.vertexAttribPointer(e.loc,o,s,!1,0,0));return e}}class r{#t;position=[0,0,0];rotation=[0,0,0];scale=[1,1,1];static#i=0;#e=e();#o=[];#s=null;#n=null;#a=null;#r;#h;#c;#l;#u;#d=!0;get modelMatrix(){return this.#g(),this.#e}set useModelMatrix(t){if(!(t instanceof Boolean))throw new Error("useModelMatrix need to be a boolean value");this.#d=t}addAttribute(t,i,e=4){if(!(i instanceof Array))throw new Error("The info parameter needs to be a Array.");i.forEach((t=>{if("number"!=typeof t)throw new Error("The info array need to be numeric.")}));const o=i.length/e;if(this.#h){if(o!==this.#h)throw new Error("The VBOs need to contain the same number of vertex.")}else this.#h=o;const s=new Float32Array(i);this.#o.push({loc:this.#t.getAttribLocation(this.#a,t),buffer:a.createBuffer(this.#t,this.#t.ARRAY_BUFFER,s),dimension:e})}constructor(t,i,e,o){this.#r=o,this.#t=t,this.createShader(i,e)}createShader(t,i){this.#s=a.createShader(this.#t,this.#t.VERTEX_SHADER,t),this.#n=a.createShader(this.#t,this.#t.FRAGMENT_SHADER,i),this.#a=a.createProgram(this.#t,this.#s,this.#n),this.#t.useProgram(this.#a)}createVAO(){this.#c=a.createVAO(this.#t,...this.#o)}#g(){var t,i,e,s,n,a,r,h,c,l,u,d,g,p,m,f,w,_;o(this.#e),t=this.#e,i=this.#e,f=(e=this.position)[0],w=e[1],_=e[2],i===t?(t[12]=i[0]*f+i[4]*w+i[8]*_+i[12],t[13]=i[1]*f+i[5]*w+i[9]*_+i[13],t[14]=i[2]*f+i[6]*w+i[10]*_+i[14],t[15]=i[3]*f+i[7]*w+i[11]*_+i[15]):(s=i[0],n=i[1],a=i[2],r=i[3],h=i[4],c=i[5],l=i[6],u=i[7],d=i[8],g=i[9],p=i[10],m=i[11],t[0]=s,t[1]=n,t[2]=a,t[3]=r,t[4]=h,t[5]=c,t[6]=l,t[7]=u,t[8]=d,t[9]=g,t[10]=p,t[11]=m,t[12]=s*f+h*w+d*_+i[12],t[13]=n*f+c*w+g*_+i[13],t[14]=a*f+l*w+p*_+i[14],t[15]=r*f+u*w+m*_+i[15]),function(t,i,e){var o=Math.sin(e),s=Math.cos(e),n=i[4],a=i[5],r=i[6],h=i[7],c=i[8],l=i[9],u=i[10],d=i[11];i!==t&&(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t[4]=n*s+c*o,t[5]=a*s+l*o,t[6]=r*s+u*o,t[7]=h*s+d*o,t[8]=c*s-n*o,t[9]=l*s-a*o,t[10]=u*s-r*o,t[11]=d*s-h*o}(this.#e,this.#e,this.rotation[0]),function(t,i,e){var o=Math.sin(e),s=Math.cos(e),n=i[0],a=i[1],r=i[2],h=i[3],c=i[8],l=i[9],u=i[10],d=i[11];i!==t&&(t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t[0]=n*s-c*o,t[1]=a*s-l*o,t[2]=r*s-u*o,t[3]=h*s-d*o,t[8]=n*o+c*s,t[9]=a*o+l*s,t[10]=r*o+u*s,t[11]=h*o+d*s}(this.#e,this.#e,this.rotation[1]),function(t,i,e){var o=Math.sin(e),s=Math.cos(e),n=i[0],a=i[1],r=i[2],h=i[3],c=i[4],l=i[5],u=i[6],d=i[7];i!==t&&(t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t[0]=n*s+c*o,t[1]=a*s+l*o,t[2]=r*s+u*o,t[3]=h*s+d*o,t[4]=c*s-n*o,t[5]=l*s-a*o,t[6]=u*s-r*o,t[7]=d*s-h*o}(this.#e,this.#e,this.rotation[2]),function(t,i,e){var o=e[0],s=e[1],n=e[2];t[0]=i[0]*o,t[1]=i[1]*o,t[2]=i[2]*o,t[3]=i[3]*o,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=i[7]*s,t[8]=i[8]*n,t[9]=i[9]*n,t[10]=i[10]*n,t[11]=i[11]*n,t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]}(this.#e,this.#e,this.scale)}createTex(t,i){this.#l=this.#t.getUniformLocation(this.#a,i),this.#u=this.#t.createTexture(),this.#t.activeTexture(this.#t[`TEXTURE${r.#i}`]),this.#t.bindTexture(this.#t.TEXTURE_2D,this.#u),this.#t.texParameteri(this.#t.TEXTURE_2D,this.#t.TEXTURE_WRAP_S,this.#t.CLAMP_TO_EDGE),this.#t.texParameteri(this.#t.TEXTURE_2D,this.#t.TEXTURE_WRAP_T,this.#t.CLAMP_TO_EDGE),this.#t.texParameteri(this.#t.TEXTURE_2D,this.#t.TEXTURE_MIN_FILTER,this.#t.NEAREST),this.#t.texParameteri(this.#t.TEXTURE_2D,this.#t.TEXTURE_MAG_FILTER,this.#t.NEAREST),this.#t.texImage2D(this.#t.TEXTURE_2D,0,this.#t.RGBA32F,this.#t.RGBA,this.#t.FLOAT,t),this.#t.useProgram(this.#a),this.#t.uniform1i(this.#l,r.#i),r.#i++}setUniformValue(t,i,e){const o=this.#t.getUniformLocation(this.#a,t);if(-1===o)throw new Error("This uniform doesn't exist in the shader code.");this.#t.useProgram(this.#a),this.#t["uniform"+e](o,i)}draw(t){this.#t.frontFace(this.#t.CCW),this.#t.enable(this.#t.CULL_FACE),this.#t.cullFace(this.#t.BACK),this.#g(),this.#t.bindVertexArray(this.#c);const i=this.#d?this.#e:e();t&&s(i,t.viewProjection,i),this.#t.useProgram(this.#a);const o=this.#t.getUniformLocation(this.#a,"mvp");-1!==i&&this.#t.uniformMatrix4fv(o,!1,i),this.#t.drawArrays(this.#r,0,this.#h),this.#t.disable(this.#t.CULL_FACE)}}n=new i(3),i!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0);class h{#p;#m;#f;set scaleX(t){if(t<=0)throw new Error("the scale of a image need to be greater than 0");this.#p.scale[0]=t}set scaleY(t){if(t<=0)throw new Error("the scale of a image need to be greater than 0");this.#p.scale[1]=t}set positionX(t){this.#p.position[0]=t}set positionY(t){this.#p.position[1]=t}set depth(t){this.#p.position[2]=t}set rotation(t){this.#p.rotation[2]=t}set scale(t){if(!(t instanceof Array)||2!==t.length)throw new Error("scale need to be a vector with two positions.");this.#p.scale=function(t,e,o){var s=new i(3);return s[0]=t,s[1]=e,s[2]=1,s}(t[0],t[1])}set opacity(t){this.#p.setUniformValue("alpha",t,"1f")}get positionX(){return this.#p.position[0]}get positionY(){return this.#p.position[1]}async init(t,i){this.#p=new r(t,"#version 300 es\n    precision highp float;\n\n    uniform mat4 mvp;\n\n    in vec4 position;\n    in vec2 texCoord;\n\n    out vec2 fTexCoord;\n\n    void main() {\n        gl_Position  = mvp * position;\n        fTexCoord = texCoord;\n    }\n","#version 300 es\n    precision highp float;\n    \n    in vec2 fTexCoord;\n\n    uniform sampler2D uTexture;\n    uniform float alpha;\n\n    out vec4 color;\n\n\n\n    void main() {\n        color = texture(uTexture, fTexCoord);\n\n        if(color.a < 0.5) discard;\n\n        color *= alpha;\n    }\n",t.TRIANGLES);const e=await this.#w(i),o=this.#_(...e);this.#p.addAttribute("position",o.coords),this.#p.addAttribute("texCoord",o.texCoords,2),this.#p.createVAO(),this.opacity=1}async loadImage(t){return new Promise((i=>{const e=new Image;e.addEventListener("load",(()=>{i(e)})),e.src=t}))}async#w(t){const i=await this.loadImage(t);await i.decode();const e=await createImageBitmap(i);return this.#p.createTex(i,"uTexture"),[e.width,e.height]}#_(t,i){const e=t/i;let o=1,s=1;e<1?o*=e:s/=e,this.#m=o,this.#f=s;const n=[-o,-s,0,1],a=[o,-s,0,1],r=[o,s,0,1],h=[-o,s,0,1];return{coords:[...n,...a,...r,...n,...r,...h],texCoords:[0,1,1,1,1,0,0,1,1,0,0,0]}}pointCollision(t,i,o){const n=[t,i,0,1],a=e();(function(t,i){t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]})(a,this.#p.modelMatrix),o&&s(a,o.viewProjection,a);const r=e();!function(t,i){var e=i[0],o=i[1],s=i[2],n=i[3],a=i[4],r=i[5],h=i[6],c=i[7],l=i[8],u=i[9],d=i[10],g=i[11],p=i[12],m=i[13],f=i[14],w=i[15],_=e*r-o*a,x=e*h-s*a,b=e*c-n*a,T=o*h-s*r,v=o*c-n*r,E=s*c-n*h,M=l*m-u*p,A=l*f-d*p,P=l*w-g*p,y=u*f-d*m,S=u*w-g*m,R=d*w-g*f,L=_*R-x*S+b*y+T*P-v*A+E*M;L&&(L=1/L,t[0]=(r*R-h*S+c*y)*L,t[1]=(s*S-o*R-n*y)*L,t[2]=(m*E-f*v+w*T)*L,t[3]=(d*v-u*E-g*T)*L,t[4]=(h*P-a*R-c*A)*L,t[5]=(e*R-s*P+n*A)*L,t[6]=(f*b-p*E-w*x)*L,t[7]=(l*E-d*b+g*x)*L,t[8]=(a*S-r*P+c*M)*L,t[9]=(o*P-e*S-n*M)*L,t[10]=(p*v-m*b+w*_)*L,t[11]=(u*b-l*v-g*_)*L,t[12]=(r*A-a*y-h*M)*L,t[13]=(e*y-o*A+s*M)*L,t[14]=(m*x-p*T-f*_)*L,t[15]=(l*T-u*x+d*_)*L)}(r,a);const h=function(t,i){const e=new Array(i.length).fill(0);if(Math.round(i.length**2)===t.length){for(let o=0;o<i.length;o++)for(let s=0;s<t.length;s+=4)e[o]+=t[s+o]*i[s/4];return e}}(r,n);return Math.abs(h[0])<this.#m&&Math.abs(h[1])<this.#f}draw(t){this.#p&&this.#p.draw(t)}}class c{#x=e();#b=e();#T=e();camPosition=[0,0,1];lookDirection=[0,0,0];upDirection=[0,1,0];left=-4;right=4;bottom=-4;top=4;near=1;far=9;fovy=Math.PI/1.3;aspect;constructor(t){this.aspect=t.width/t.height}#v="perspective";set projectionType(t){if("orthogonal"!==t&&"perspective"!==t)throw new Error("Invalid type of projection.");this.typeOfProjection=t}get viewMatrix(){return this.#E(),this.#x}get projMatrix(){return this.#M(),this.#b}#E(){o(this.#x),function(i,e,s,n){var a,r,h,c,l,u,d,g,p,m,f=e[0],w=e[1],_=e[2],x=n[0],b=n[1],T=n[2],v=s[0],E=s[1],M=s[2];Math.abs(f-v)<t&&Math.abs(w-E)<t&&Math.abs(_-M)<t?o(i):(d=f-v,g=w-E,p=_-M,a=b*(p*=m=1/Math.hypot(d,g,p))-T*(g*=m),r=T*(d*=m)-x*p,h=x*g-b*d,(m=Math.hypot(a,r,h))?(a*=m=1/m,r*=m,h*=m):(a=0,r=0,h=0),c=g*h-p*r,l=p*a-d*h,u=d*r-g*a,(m=Math.hypot(c,l,u))?(c*=m=1/m,l*=m,u*=m):(c=0,l=0,u=0),i[0]=a,i[1]=c,i[2]=d,i[3]=0,i[4]=r,i[5]=l,i[6]=g,i[7]=0,i[8]=h,i[9]=u,i[10]=p,i[11]=0,i[12]=-(a*f+r*w+h*_),i[13]=-(c*f+l*w+u*_),i[14]=-(d*f+g*w+p*_),i[15]=1)}(this.#x,this.camPosition,this.lookDirection,this.upDirection)}#M(){o(this.#b),"perspective"==this.typeOfProjection?function(t,i,e,o,s){var n,a=1/Math.tan(i/2);t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(n=1/(o-s),t[10]=(s+o)*n,t[14]=2*s*o*n):(t[10]=-1,t[14]=-2*o)}(this.#b,this.fovy,this.aspect,this.near,this.far):function(t,i,e,o,s,n,a){var r=1/(i-e),h=1/(o-s),c=1/(n-a);t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(i+e)*r,t[13]=(s+o)*h,t[14]=(a+n)*c,t[15]=1}(this.#b,this.left,this.right,this.bottom,this.top,this.left,this.right)}get viewProjection(){return this.#E(),this.#M(),o(this.#T),s(this.#T,this.#b,this.#x),this.#T}}const l=document.querySelector("#game-screen");let u=0;const d=l.getContext("webgl2");function g(t,i,e){const o=[t-e.offsetLeft-e.width/2,e.height/2-(i-e.offsetTop)];return[2*o[0]/e.width,2*o[1]/e.height]}d.viewport(0,0,d.canvas.width,d.canvas.height),d.clearColor(0,0,0,1),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);class p{async init(){this.show_cards=new h,await this.show_cards.init(d,"./assets/game/show_cards.png"),this.show_cards.scale=[1.7,3],console.log(this.show_cards.positionX),p.setInitialPosition(this.show_cards.positionX,-6.355,.3,this.show_cards),this.cancel_button=new h,await this.cancel_button.init(d,"./assets/game/cancel_button.png"),this.cancel_button.scale=[.27,.48],p.setInitialPosition(-1.42,-6.2,.4,this.cancel_button),this.ok_button=new h,await this.ok_button.init(d,"./assets/game/ok_button.png"),this.ok_button.scale=[.27,.48],p.setInitialPosition(1.42,-6.2,.4,this.ok_button),this.cards_info=new h,await this.cards_info.init(d,"assets/game/cards_info.png"),this.cards_info.scale=[.8,1.35],p.setInitialPosition(6.35,this.cards_info.positionY,.3,this.cards_info)}static setInitialPosition(t,i,e,o){o.positionX=t,o.positionY=i,o.depth=e}moveAll(t,i){this.show_cards.positionY+=i,this.cancel_button.positionY+=i,this.ok_button.positionY+=i,this.cards_info.positionX+=t}draw(t){this.show_cards.draw(t),this.cancel_button.draw(t),this.ok_button.draw(t),this.cards_info.draw(t)}}class m{async init(){this.fortify=new h,await this.fortify.init(d,"./assets/game/fortify.png"),this.fortify.scale=[1.7,3],m.setInitialPosition(this.fortify.positionX,-3.25,.3,this.fortify),this.cancel_button=new h,await this.cancel_button.init(d,"./assets/game/cancel_button.png"),this.cancel_button.scale=[.27,.48],p.setInitialPosition(1.42,-3.2,.4,this.cancel_button),this.ok_button=new h,await this.ok_button.init(d,"./assets/game/ok_button.png"),this.ok_button.scale=[.27,.48],p.setInitialPosition(1.42,-3.2,.4,this.ok_button)}static setInitialPosition(t,i,e,o){o.positionX=t,o.positionY=i,o.depth=e}moveAll(t){this.fortify.positionY+=t,this.cancel_button.positionY+=t,this.ok_button.positionY+=t}draw(t){this.fortify.draw(t),this.cancel_button.draw(t),this.ok_button.draw(t)}}!async function(t){const i=new h;await i.init(t,"./assets/menu/fundo.jpg");const e=new h;await e.init(t,"./assets/menu/logo_war.png");const o=new h;await o.init(t,"./assets/menu/play_button.png");const s=new h;await s.init(t,"./assets/menu/settings_button.png");const n=new h;await n.init(t,"./assets/menu/max_button.png"),i.scale=[4,7.3],e.scale=[1.35,2],o.scale=[.65,1.1],s.scale=[.15,.27],n.scale=[.15,.27],e.positionY=.25,o.positionY=-1.9,s.positionX=3.7,s.positionY=2.8,n.positionX=3.7,n.positionY=3.5;const a=new c(t.canvas);t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS),e.draw(a),o.draw(a),s.draw(a),n.draw(a),i.draw(a),t.disable(t.DEPTH_TEST),l.addEventListener("click",(i=>{const e=g(i.clientX,i.clientY,l);o.pointCollision(...e,a)&&(u=1,async function(t){const i=new h;await i.init(t,"./assets/mapa.jpg");const e=new h;await e.init(t,"./assets/menu/settings_button.png");const o=new h;await o.init(t,"./assets/menu/max_button.png");const s=new h;await s.init(t,"./assets/game/card_button.png");const n=new h;await n.init(t,"./assets/game/objective_button.png");const a=new h;await a.init(t,"./assets/game/current_player.png");const r=new h;await r.init(t,"./assets/game/show_players.png");const u=new p;await u.init();const d=new m;await d.init(),e.scale=[.15,.27],o.scale=[.15,.27],s.scale=[.5,.8],n.scale=[.47,.8],a.scale=[1.5,2.5],i.scale=[4,7.4],r.scale=[.47,.8],e.positionX=3.7,e.positionY=2.8,e.depth=.2,o.positionX=3.7,o.positionY=3.5,o.depth=.2,s.positionX=2.9,s.positionY=-3.2,s.depth=.2,n.positionX=3.6,n.positionY=-3.2,n.depth=.2,r.positionX=-3.6,r.positionY=-3.2,r.depth=.2,a.positionY=-3.375,a.depth=.2;const f=new c(l);let w=!1;t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS),i.draw(f),e.draw(f),s.draw(f),n.draw(f),a.draw(f),o.draw(f),r.draw(f),u.draw(f),t.disable(t.DEPTH_TEST);let _=0,x=0;l.addEventListener("mousedown",(t=>{_=t.clientX,x=t.clientY,w=!0})),l.addEventListener("mouseup",(t=>{w=!1,console.log(_,x)})),l.addEventListener("mousemove",(t=>{if(w){let i=t.clientX-_,e=t.clientY-x;console.log(i,e)}})),l.addEventListener("click",(t=>{const e=g(t.clientX,t.clientY,l);s.pointCollision(...e,f)&&(u.moveAll(-3,3),i.draw(f),u.draw(f)),u.cancel_button.pointCollision(...e,f)&&alert("cancel"),u.ok_button.pointCollision(...e,f)&&alert("ok")}))}(t)),n.pointCollision(...e,a)&&alert("FullScreen")}))}(d)})();
//# sourceMappingURL=main.bundle.js.map