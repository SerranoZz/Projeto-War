(()=>{"use strict";var t=1e-6,e="undefined"!=typeof Float32Array?Float32Array:Array;function i(){var t=new e(16);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function n(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],o=e[4],a=e[5],h=e[6],l=e[7],c=e[8],u=e[9],d=e[10],g=e[11],m=e[12],f=e[13],p=e[14],w=e[15],_=i*a-s*o,y=i*h-r*o,b=i*l-n*o,v=s*h-r*a,x=s*l-n*a,C=r*l-n*h,M=c*f-u*m,P=c*p-d*m,T=c*w-g*m,E=u*p-d*f,A=u*w-g*f,I=d*w-g*p,S=_*I-y*A+b*E+v*T-x*P+C*M;return S?(S=1/S,t[0]=(a*I-h*A+l*E)*S,t[1]=(r*A-s*I-n*E)*S,t[2]=(f*C-p*x+w*v)*S,t[3]=(d*x-u*C-g*v)*S,t[4]=(h*T-o*I-l*P)*S,t[5]=(i*I-r*T+n*P)*S,t[6]=(p*b-m*C-w*y)*S,t[7]=(c*C-d*b+g*y)*S,t[8]=(o*A-a*T+l*M)*S,t[9]=(s*T-i*A-n*M)*S,t[10]=(m*x-f*b+w*_)*S,t[11]=(u*b-c*x-g*_)*S,t[12]=(a*P-o*E-h*M)*S,t[13]=(i*E-s*P+r*M)*S,t[14]=(f*y-m*v-p*_)*S,t[15]=(c*v-u*y+d*_)*S,t):null}function o(t,e,i){var s=e[0],r=e[1],n=e[2],o=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],d=e[9],g=e[10],m=e[11],f=e[12],p=e[13],w=e[14],_=e[15],y=i[0],b=i[1],v=i[2],x=i[3];return t[0]=y*s+b*a+v*u+x*f,t[1]=y*r+b*h+v*d+x*p,t[2]=y*n+b*l+v*g+x*w,t[3]=y*o+b*c+v*m+x*_,y=i[4],b=i[5],v=i[6],x=i[7],t[4]=y*s+b*a+v*u+x*f,t[5]=y*r+b*h+v*d+x*p,t[6]=y*n+b*l+v*g+x*w,t[7]=y*o+b*c+v*m+x*_,y=i[8],b=i[9],v=i[10],x=i[11],t[8]=y*s+b*a+v*u+x*f,t[9]=y*r+b*h+v*d+x*p,t[10]=y*n+b*l+v*g+x*w,t[11]=y*o+b*c+v*m+x*_,y=i[12],b=i[13],v=i[14],x=i[15],t[12]=y*s+b*a+v*u+x*f,t[13]=y*r+b*h+v*d+x*p,t[14]=y*n+b*l+v*g+x*w,t[15]=y*o+b*c+v*m+x*_,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var a;class h{static createShader(t,e,i){const s=t.createShader(e);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(s);throw new Error("Shader compilation error: "+e)}return s}static createProgram(t,e,i){const s=t.createProgram();if(t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){const e=t.getProgramInfoLog(s);throw new Error("Could not compile WebGL program:"+e)}return s}static createBuffer(t,e,i){if(0==i.length)return null;if(!(i&&i.buffer instanceof ArrayBuffer&&void 0!==i.byteLength))return console.warn("Data is not an instance of ArrayBuffer"),null;const s=t.createBuffer();return t.bindBuffer(e,s),t.bufferData(e,i,t.STATIC_DRAW),s}static createVAO(t,...e){if(!(t instanceof WebGL2RenderingContext))return;const i=t.createVertexArray();let s,r;t.bindVertexArray(i);for(let i of e)null!=i.loc&&null!=i.loc&&(t.enableVertexAttribArray(i.loc),s=i.dimension,r=t.FLOAT,t.bindBuffer(t.ARRAY_BUFFER,i.buffer),t.vertexAttribPointer(i.loc,s,r,!1,0,0));return i}}class l{_gl;position=[0,0,0];rotation=[0,0,0];scale=[1,1,1];#t=i();#e=[];#i=null;#s=null;_program=null;_primitive;#r;_vaoLoc;#n;#o=[];#a=!1;useDepthTest=!1;get modelMatrix(){return this.updateModelMatrix(),this.#t}addAttribute(t,e,i=4){if(!(e instanceof Array))throw new Error("The info parameter needs to be a Array.");e.forEach((t=>{if("number"!=typeof t)throw new Error("The info array need to be numeric.")}));const s=e.length/i;if(this.#r){if(s!==this.#r)throw new Error("The VBOs need to contain the same number of vertex.")}else this.#r=s;const r=new Float32Array(e);this.#e.push({loc:this._gl.getAttribLocation(this._program,t),buffer:h.createBuffer(this._gl,this._gl.ARRAY_BUFFER,r),dimension:i}),this.#a=!1}constructor(t,e,i,s){this._primitive=s,this._gl=t,this.#h(e,i)}#h(t,e){this.#i=h.createShader(this._gl,this._gl.VERTEX_SHADER,t),this.#s=h.createShader(this._gl,this._gl.FRAGMENT_SHADER,e),this._program=h.createProgram(this._gl,this.#i,this.#s),this._gl.useProgram(this._program)}#l(){this._vaoLoc=h.createVAO(this._gl,...this.#e)}updateModelMatrix(){var t,e,i,s,n,o,a,h,l,c,u,d,g,m,f,p,w,_;r(this.#t),t=this.#t,e=this.#t,p=(i=this.position)[0],w=i[1],_=i[2],e===t?(t[12]=e[0]*p+e[4]*w+e[8]*_+e[12],t[13]=e[1]*p+e[5]*w+e[9]*_+e[13],t[14]=e[2]*p+e[6]*w+e[10]*_+e[14],t[15]=e[3]*p+e[7]*w+e[11]*_+e[15]):(s=e[0],n=e[1],o=e[2],a=e[3],h=e[4],l=e[5],c=e[6],u=e[7],d=e[8],g=e[9],m=e[10],f=e[11],t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=h,t[5]=l,t[6]=c,t[7]=u,t[8]=d,t[9]=g,t[10]=m,t[11]=f,t[12]=s*p+h*w+d*_+e[12],t[13]=n*p+l*w+g*_+e[13],t[14]=o*p+c*w+m*_+e[14],t[15]=a*p+u*w+f*_+e[15]),function(t,e,i){var s=Math.sin(i),r=Math.cos(i),n=e[4],o=e[5],a=e[6],h=e[7],l=e[8],c=e[9],u=e[10],d=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*r+l*s,t[5]=o*r+c*s,t[6]=a*r+u*s,t[7]=h*r+d*s,t[8]=l*r-n*s,t[9]=c*r-o*s,t[10]=u*r-a*s,t[11]=d*r-h*s}(this.#t,this.#t,this.rotation[0]),function(t,e,i){var s=Math.sin(i),r=Math.cos(i),n=e[0],o=e[1],a=e[2],h=e[3],l=e[8],c=e[9],u=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r-l*s,t[1]=o*r-c*s,t[2]=a*r-u*s,t[3]=h*r-d*s,t[8]=n*s+l*r,t[9]=o*s+c*r,t[10]=a*s+u*r,t[11]=h*s+d*r}(this.#t,this.#t,this.rotation[1]),function(t,e,i){var s=Math.sin(i),r=Math.cos(i),n=e[0],o=e[1],a=e[2],h=e[3],l=e[4],c=e[5],u=e[6],d=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r+l*s,t[1]=o*r+c*s,t[2]=a*r+u*s,t[3]=h*r+d*s,t[4]=l*r-n*s,t[5]=c*r-o*s,t[6]=u*r-a*s,t[7]=d*r-h*s}(this.#t,this.#t,this.rotation[2]),function(t,e,i){var s=i[0],r=i[1],n=i[2];t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this.#t,this.#t,this.scale)}loadMVP(t){const e=this._gl.getUniformLocation(this._program,"model"),r=this._gl.getUniformLocation(this._program,"modelView"),n=this._gl.getUniformLocation(this._program,"mvp"),a=this._gl.getUniformLocation(this._program,"view"),h=this._gl.getUniformLocation(this._program,"viewProjection"),l=this._gl.getUniformLocation(this._program,"projection");if(e)this._gl.uniformMatrix4fv(e,!1,this.#t);else if(r){const e=i();t?o(e,t.viewMatrix,this.#t):s(e,this.#t),this._gl.uniformMatrix4fv(r,!1,e)}else if(n){const e=i();t?o(e,t.viewProjection,this.#t):s(e,this.#t),this._gl.uniformMatrix4fv(n,!1,e)}a&&this._gl.uniformMatrix4fv(e,!1,t.viewMatrix),l&&this._gl.uniformMatrix4fv(e,!1,t.projMatrix),h&&this._gl.uniformMatrix4fv(e,!1,t.viewProjection)}createTex(t,e){const i=this._gl.getUniformLocation(this._program,e);if(!i)throw new Error(`The uniform ${e} doesn't exists in shader code.`);const s=new c(i,this._gl.createTexture(),t);this.#o.push(s);const r=this.#o.length-1;return this._gl.activeTexture(this._gl[`TEXTURE${r}`]),this._gl.bindTexture(this._gl.TEXTURE_2D,this.#o[r].texture),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA32F,this._gl.RGBA,this._gl.FLOAT,t),this._gl.useProgram(this._program),this._gl.uniform1i(this.#n,r),{tex:this.#o[r],index:r}}bindTextures(){this.#o.forEach((t=>{t.bind(this._gl)}))}setUniformValue(t,e,i){const s=this._gl.getUniformLocation(this._program,t);if(-1===s)throw new Error("This uniform doesn't exist in the shader code.");this._gl.useProgram(this._program),i.startsWith("Matrix")?this._gl["uniform"+i](s,!1,e):this._gl["uniform"+i](s,e)}draw(t){this.#a||(this.#a=!0,this.#l()),this._gl.frontFace(this._gl.CCW),this._gl.enable(this._gl.CULL_FACE),this._gl.cullFace(this._gl.BACK),this.useDepthTest&&(this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LESS)),this.updateModelMatrix(),this._gl.bindVertexArray(this._vaoLoc),this._gl.useProgram(this._program),this.loadMVP(t),this.bindTextures(),this._gl.drawArrays(this._primitive,0,this.#r),this._gl.disable(this._gl.CULL_FACE),this.useDepthTest&&this.gl.disable(this._gl.DEPTH_TEST)}static changeTex(t,{tex:e,index:i},s){e.data=s}}class c{#c;#u;#d;#g=!1;constructor(t,e,i){this.#c=t,this.#u=e,this.#d=i}get uniform(){return this.#c}get texture(){return this.#u}get data(){return this.#d}set data(t){this.#d=t,this.#g=!0}bind(t){t.bindTexture(t.TEXTURE_2D,this.#u),this.#g&&(t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,t.RGBA,t.FLOAT,this.#d),this.#g=!1)}}a=new e(3),e!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);class u{#m;#f;#p;get width(){return this.#f}get height(){return this.#p}set scaleX(t){if(t<=0)throw new Error("the scale of a image need to be greater than 0");this.#m.scale[0]=t}set scaleY(t){if(t<=0)throw new Error("the scale of a image need to be greater than 0");this.#m.scale[1]=t}set positionX(t){this.#m.position[0]=t}set positionY(t){this.#m.position[1]=t}set depth(t){this.#m.position[2]=t}set rotation(t){this.#m.rotation[2]=t}set scale(t){if(!(t instanceof Array)||2!==t.length)throw new Error("scale need to be a vector with two positions.");this.#m.scale=function(t,i,s){var r=new e(3);return r[0]=t,r[1]=i,r[2]=1,r}(t[0],t[1])}set opacity(t){this.#m.setUniformValue("alpha",t,"1f")}get positionX(){return this.#m.position[0]}get positionY(){return this.#m.position[1]}get depthZ(){return this.#m.position[2]}async init(t,e){this.#m=new l(t,"#version 300 es\n    precision highp float;\n\n    uniform mat4 mvp;\n\n    in vec4 position;\n    in vec2 texCoord;\n\n    out vec2 fTexCoord;\n\n    void main() {\n        gl_Position  = mvp * position;\n        fTexCoord = texCoord;\n    }\n","#version 300 es\n    precision highp float;\n    \n    in vec2 fTexCoord;\n\n    uniform sampler2D uTexture;\n    uniform float alpha;\n\n    out vec4 color;\n\n    void main() {\n        color = texture(uTexture, fTexCoord);\n\n        if(color.a < 0.9) discard;\n\n        color *= alpha;\n    }\n",t.TRIANGLES);const i=await this.#w(e),s=this.#_(...i);this.#m.addAttribute("position",s.coords),this.#m.addAttribute("texCoord",s.texCoords,2),this.opacity=1}static async loadImage(t){return new Promise((e=>{const i=new Image;i.addEventListener("load",(()=>{e(i)})),i.src=t}))}async#w(t){const e=await u.loadImage(t);await e.decode();const i=await createImageBitmap(e);return this._tex=this.#m.createTex(e,"uTexture"),[i.width,i.height]}#_(t,e){const i=t/e;let s=1,r=1;i<1?s*=i:r/=i,this.#f=s,this.#p=r;const n=[-s,-r,0,1],o=[s,-r,0,1],a=[s,r,0,1],h=[-s,r,0,1];return{coords:[...n,...o,...a,...n,...a,...h],texCoords:[0,1,1,1,1,0,0,1,1,0,0,0]}}useDepthTest(){this.#m.useDepthTest=!0}pointCollision(t,e,r){const a=i();s(a,this.#m.modelMatrix),r&&o(a,r.viewProjection,a);const h=i();n(h,a);const l=r?r.near:1,c=r?r.far:1,u=g(h,[t,e,l,1]),f=g(h,[t,e,c,1]),p=d(u,1/u[3]),w=d(f,1/f[3]),_=new m(w,p).pointWhenZIs(0);return Math.abs(_[0])<this.#f&&Math.abs(_[1])<this.#p}draw(t){this.#m&&this.#m.draw(t)}}function d(t,e){return t.map((t=>t*e))}function g(t,e){const i=new Array(e.length).fill(0);if(Math.round(e.length**2)===t.length){for(let s=0;s<e.length;s++)for(let r=0;r<t.length;r+=4)i[s]+=t[r+s]*e[r/4];return i}}class m{#y;#b;constructor(t,e){const i=this.#v(t,e);this.#b=i,this.#y=e}getPoint(t){return this.#y.map(((e,i)=>e+t*this.#b[i]))}pointWhenZIs(t){const e=this.#b[2]?(t-this.#y[2])/this.#b[2]:0;return this.getPoint(e)}#v(t,e){const i=t.map(((t,i)=>t-e[i])),s=Math.sqrt(i.reduce(((t,e)=>t+e**2),0));return s?i.map((t=>t/s)):i}}const f="#version 300 es\n    precision highp float;\n\n    uniform mat4 model;\n    uniform mat4 view;\n    uniform mat4 projection;\n    uniform vec4 color;\n\n    in vec4 position;\n    in vec4 normal;\n\n    out vec4 fPos;\n    out vec4 fColor;\n    out vec4 fNormal;\n\n    void main() {\n        gl_Position = (projection*view*model) * position;\n        gl_Position /= gl_Position.w;\n        fColor = color;\n        fPos = position;\n        fNormal = normal;\n    }\n",p="#version 300 es\n    precision highp float;\n    \n    uniform mat4 model;\n    uniform mat4 view;\n    uniform mat4 projection;\n\n    uniform vec3 amb_c;\n    uniform vec3 dif_c;\n    uniform vec3 esp_c;\n    uniform vec3 pos;\n    uniform float amb_k;\n    uniform float dif_k;\n    uniform float esp_k;\n    uniform float esp_p;\n\n    in vec4 fColor;\n    in vec4 normal;\n    in vec4 fPos;\n    in vec4 fNormal;\n\n    out vec4 color;\n\n    void main() {\n        mat4 modelView = view*model;\n\n        vec3 lightPos = (view * vec4(pos, 1.0)).xyz;\n        vec3 pos = -(modelView * fPos).xyz;\n\n        vec3 vNormal = normalize(inverse(transpose(modelView)) * fNormal).xyz;\n        vec3 vDistance = normalize(pos - lightPos);\n\n        vec3 normalPos = normalize(pos);\n\n        vec3 halfVector= normalize(vDistance + normalPos);\n\n        vec3 amb = amb_k * amb_c;\n\n        vec3 diff = max(dot(vNormal, vDistance), 0.0) * dif_k * dif_c;\n\n        vec3 spec = max(pow(dot(vNormal, halfVector), esp_p), 0.0) * esp_c * esp_k;\n\n        vec3 color3 = vec3(fColor);\n        \n        color3 = 0.5*color3 + 0.5*(diff + amb + spec);\n\n        color = vec4(color3, 1.0);\n    }\n";class w{attributes=new Map;id;hEdge;constructor(t){this.id=t}}class _{opositte;next;vertex;constructor(t){this.vertex=t}}class y{hEdge;constructor(t){this.hEdge=t}}class b{#x=[];#C=[];#M=[];constructor(t){for(let e=0;e<t.length;e+=3){const i=t[e],s=t[e+1],r=t[e+2];this.#C[i]||(this.#C[i]=new w(i)),this.#C[s]||(this.#C[s]=new w(s)),this.#C[r]||(this.#C[r]=new w(r));const n=new _(this.#C[i]),o=new _(this.#C[s]),a=new _(this.#C[r]);n.next=o,o.next=a,a.next=n;const h=new y(n);this.#x[e]=n,this.#x[e+1]=o,this.#x[e+2]=a,this.#M[Math.round(e/3)]=h}this.setOposittes()}setOposittes(){for(let t of this.#x){const e=t.vertex,i=t.next.vertex;if(e.hEdge||(e.hEdge=t),!t.opositte)for(let s of this.#x)if(s.vertex===i&&s.next.vertex===e){t.opositte=s,s.opositte=t;break}}}setAttribute(t,e,i){if(t.length/e!==this.#C.length)throw new Error(`Mesh haves ${this.#C.length} vertices, but only ${t.length/e} were given.`);for(let s=0;s<t.length;s+=e){const r=t.slice(s,s+e);this.#C[Math.round(s/e)].attributes.set(i,r)}}createVBOs(){const t=new Map,e=[];for(let e of this.#C)for(let i of e.attributes.keys())t.get(i)||t.set(i,[]),t.get(i).push(...e.attributes.get(i));for(let t of this.#x)e.push(t.vertex.id);return{attributes:t,indexes:e,count:this.#C.length}}}class v extends l{#P;#T=-1;#E;#a=!1;set border(t){this.#E=t}constructor(t,e,i,s){super(t,e,i,t.TRIANGLES),this.#P=new b(s)}addAttribute(t,e,i=4){if(!(e instanceof Array))throw new Error("The info parameter needs to be a Array.");if(e.forEach((t=>{if("number"!=typeof t)throw new Error("The info array need to be numeric.")})),-1===this._gl.getAttribLocation(this._program,t))throw new Error(`the attribute ${t} doesn't exists in the shader code.`);this.#P.setAttribute(e,i,t),this.#a=!1}#l(){const t=this.#P.createVBOs(),e=Array.from(t.attributes.entries()).map((e=>({loc:this._gl.getAttribLocation(this._program,e[0]),buffer:h.createBuffer(this._gl,this._gl.ARRAY_BUFFER,new Float32Array(e[1])),dimension:Math.round(e[1].length/t.count)})));this._vaoLoc=h.createVAO(this._gl,...e),this.#T=h.createBuffer(this._gl,this._gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.indexes)),this._count=t.indexes.length,this.#a=!0}draw(t){this.#a||this.#l(),this.useDepthTest&&(this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LESS)),this._gl.frontFace(this._gl.CCW),this._gl.enable(this._gl.CULL_FACE),this._gl.cullFace(this._gl.BACK),this._gl.bindVertexArray(this._vaoLoc),this._gl.useProgram(this._program),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.#T);const e=this._gl.getUniformLocation(this._program,"model"),s=this._gl.getUniformLocation(this._program,"modelView"),r=this._gl.getUniformLocation(this._program,"mvp");if(e)this._gl.uniformMatrix4fv(e,!1,this.modelMatrix);else if(s){const s=i();o(s,t.viewMatrix,this.modelMatrix),this._gl.uniformMatrix4fv(e,!1,s)}else if(r){const s=i();o(s,t.viewProjection,this.modelMatrix),this._gl.uniformMatrix4fv(e,!1,s)}this._gl.drawElements(this._primitive,this._count,this._gl.UNSIGNED_INT,0),this._gl.disable(this._gl.CULL_FACE),this.useDepthTest&&this._gl.disable(this._gl.DEPTH_TEST)}pointCollision(t,e,i){return!!this.#E&&this.#E.pointCollision(t,e,i,this)}get center(){return this.#E.center}get drawBorder(){return this.#E.draw()}static async loadMeshFromObj(t,e,i,s,r){const n=await fetch(t),o=await n.text(),a=new Map,h=o.split("\n"),l=[],c=[],d=[],g=[];let m=0;for(let t of h)if(t.startsWith("vn")){const e=t.replace("vn ","").split(" ").map(Number.parseFloat);c.push(...e,1);const i=Math.sqrt(x(e,e));if(Math.abs(x(e,[0,0,1])/i)<.5){const t=e.join(",");a.get(t)||a.set(t,m)}m++}else if(t.startsWith("vt")){const e=t.replace("vt ","").split(" ").map(Number.parseFloat);d.push(...e)}else if(t.startsWith("v")){const e=t.replace("v ","").split(" ").map(Number.parseFloat);l.push(...e,1)}else if(t.startsWith("f")){const e=t.replace("f ","").split(" ").map((t=>{const e=t.indexOf("/"),i=t.slice(0,e);return Number.parseInt(i)-1}));g.push(...e)}const f=new C(a,l,e),p=new v(e,i,s,g);if(p.addAttribute("position",l),p.addAttribute("normal",c),p.useDepthTest=!0,0!==d.length){if(!r)throw new Error("This mesh need to a texture path");p.addAttribute("texCoord",d,3);const t=await u.loadImage(r);p.createTex(t,"uTexture")}return p.border=f,p}}const x=(t,e)=>t.reduce(((t,i,s)=>t+i*e[s]),0);class C{#A;#I;#S;#k;#L;#U;constructor(t,e){this.#A=t,this.#I=e;let i=1/0,s=-1/0,r=1/0,n=-1/0,o=1/0,a=-1/0;for(let t=0;t<this.#I.length;t+=4)this.#I[t+2]<i&&(i=this.#I[t+2]),this.#I[t+2]>s&&(s=this.#I[t+2]),this.#I[t]<r&&(r=this.#I[t]),this.#I[t]>n&&(n=this.#I[t]),this.#I[t+1]<o&&(o=this.#I[t+1]),this.#I[t+1]>a&&(a=this.#I[t+1]);this.#L=i,this.#U=s,this.center=[r,o]}pointCollision(t,e,i,s){return this.#S=null,this.#k=null,this.#R(t,e,this.#L,i,s)||this.#R(t,e,this.#U,i,s)}#R(t,e,r,a,h){const l=i();s(l,h.modelMatrix),a&&o(l,a.viewProjection,l);const c=i();n(c,l);const u=a?a.near:1,d=a?a.far:1,g=C.multiplyMatWithVec(c,[t,e,u,1]),m=C.multiplyMatWithVec(c,[t,e,d,1]),f=C.scalarMulti(g,1/g[3]),p=C.scalarMulti(m,1/m[3]),w=new M(p,f).pointWhenZIs(r);return this.#S?this.#k=w:this.#S=w,this.#D(w)}#D(t){let[e,i]=[1/0,1/0],[s,r]=[-1/0,-1/0];for(let t of this.#A.entries()){const n=4*t[1],o=[this.#I[n],this.#I[n+1]];o[0]<e&&(e=o[0]),o[1]<i&&(i=o[1]),o[0]>s&&(s=o[0]),o[1]>r&&(r=o[1])}return t[0]>=e&&t[0]<=s&&t[1]>=i&&t[1]<=r}#O(t){let e,i,s=0;for(let r of this.#A.entries()){const n=4*r[1],o=[this.#I[n],this.#I[n+1]];if(!e){e=o,i=o;continue}const a=this.leftToEdge(t,i,o);if(2===a)return!0;a&&s++,i=o}return this.leftToEdge(t,i,e)&&s++,s%2==1}leftToEdge(t,e,i){if(i[0]===t[0]&&i[1]===t[1])return!0;if(e[0]===t[0]&&e[1]===t[1])return!0;const s=[i[1],e[1]];s.sort();const[r,n]=s;if(t[1]>=n||t[1]<=r)return!1;const o=e[0]-i[0];if(!o)return t[0]<=e[0];const a=(e[1]-i[1])/o,h=e[0]-e[0]*a;return t[0]<=(t[1]-h)/a}draw(){const t=document.createElement("canvas");t.width=1e3,t.height=1e3,t.style.backgroundColor="rgb(100, 0, 0)";const e=t.getContext("2d");let i;e.beginPath();for(let t of this.#A.entries()){const s=4*t[1],r=[this.#I[s],this.#I[s+1],this.#I[s+2]];i?e.lineTo(500*r[0]+250,500*(1-r[1])):(i=r,e.moveTo(500*r[0]+250,500*(1-r[1])))}return e.lineTo(500*i[0]+250,500*(1-i[1])),e.stroke(),this.#S&&e.fillRect(500*this.#S[0]+250,500*(1-this.#S[1]),5,5),this.#k&&e.fillRect(500*this.#k[0]+250,500*(1-this.#k[1]),5,5),t}static multiplyMatWithVec(t,e){const i=new Array(e.length).fill(0);if(Math.round(e.length**2)===t.length){for(let s=0;s<e.length;s++)for(let r=0;r<t.length;r+=4)i[s]+=t[r+s]*e[r/4];return i}}static scalarMulti(t,e){return t.map((t=>t*e))}}class M{#y;#b;constructor(t,e){const i=this.#v(t,e);this.#b=i,this.#y=e}getPoint(t){return this.#y.map(((e,i)=>e+t*this.#b[i]))}pointWhenZIs(t){const e=(t-this.#y[2])/this.#b[2];return this.getPoint(e)}#v(t,e){const i=t.map(((t,i)=>t-e[i])),s=Math.sqrt(i.reduce(((t,e)=>t+e**2),0));return i.map((t=>t/s))}}class P{#j;#V;#F;#N;#B;#G;#m;#Y;constructor(t,e,i,s){this.#j=t,this.#V=e,this.#F=s,this.#N=null,this.#B=i,this.#G=1}get name(){return this.#j}get path(){return this.#V}get neighbors(){return this.#F}get owner(){return this.#N}get continent(){return this.#B}get soldiers(){return this.#G}get mesh(){return this.#m}get pointMesh(){return this.#Y}set continent(t){this.#B=t,t.addCountry(this)}set owner(t){this.#N=t}set soldiers(t){this.#G=t}findNeighbor(t){for(let e=0;e<this.#F.length;e++)if(this.#F[e]==t)return e;return-1}async loadMesh(t,e,i,s){this.#m=await v.loadMeshFromObj(t,e,f,p),this.#m.scale=[i,i,1],this.#Y=await v.loadMeshFromObj(s,e,f,p),this.#Y.scale=[i,i,1]}loadUniforms(t){this.#m.setUniformValue("view",t.viewMatrix,"Matrix4fv"),this.#m.setUniformValue("projection",t.projMatrix,"Matrix4fv"),this.#m.setUniformValue("color",this.#N.color,"4fv"),this.#Y.setUniformValue("view",t.viewMatrix,"Matrix4fv"),this.#Y.setUniformValue("projection",t.projMatrix,"Matrix4fv"),this.#N.color.reduce(((t,e)=>t&&1===e)),this.#Y.setUniformValue("color",this.#N.color,"4fv")}draw(t){this.#m.draw(t),this.#Y.draw(t)}changeColor(){this.#m.setUniformValue("color",this.#N.color,"4fv")}}class T{#X=i();#W=i();#q=i();camPosition=[0,0,1];lookDirection=[0,0,0];upDirection=[0,1,0];left=-4;right=4;bottom=-4;top=4;near=1;far=9;fovy=Math.PI/2;aspect;constructor(t){this.aspect=t.width/t.height}#K="perspective";set projectionType(t){if("orthogonal"!==t&&"perspective"!==t)throw new Error("Invalid type of projection.");this.#K=t}get viewMatrix(){return this.#$(),this.#X}get projMatrix(){return this.#z(),this.#W}#$(){r(this.#X),function(e,i,s,n){var o,a,h,l,c,u,d,g,m,f,p=i[0],w=i[1],_=i[2],y=n[0],b=n[1],v=n[2],x=s[0],C=s[1],M=s[2];Math.abs(p-x)<t&&Math.abs(w-C)<t&&Math.abs(_-M)<t?r(e):(d=p-x,g=w-C,m=_-M,o=b*(m*=f=1/Math.hypot(d,g,m))-v*(g*=f),a=v*(d*=f)-y*m,h=y*g-b*d,(f=Math.hypot(o,a,h))?(o*=f=1/f,a*=f,h*=f):(o=0,a=0,h=0),l=g*h-m*a,c=m*o-d*h,u=d*a-g*o,(f=Math.hypot(l,c,u))?(l*=f=1/f,c*=f,u*=f):(l=0,c=0,u=0),e[0]=o,e[1]=l,e[2]=d,e[3]=0,e[4]=a,e[5]=c,e[6]=g,e[7]=0,e[8]=h,e[9]=u,e[10]=m,e[11]=0,e[12]=-(o*p+a*w+h*_),e[13]=-(l*p+c*w+u*_),e[14]=-(d*p+g*w+m*_),e[15]=1)}(this.#X,this.camPosition,this.lookDirection,this.upDirection)}#z(){r(this.#W),"perspective"===this.#K?function(t,e,i,s,r){var n,o=1/Math.tan(e/2);t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(n=1/(s-r),t[10]=(r+s)*n,t[14]=2*r*s*n):(t[10]=-1,t[14]=-2*s)}(this.#W,this.fovy,this.aspect,this.near,this.far):function(t,e,i,s,r,n,o){var a=1/(e-i),h=1/(s-r),l=1/(n-o);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*a,t[13]=(r+s)*h,t[14]=(o+n)*l,t[15]=1}(this.#W,this.left*this.aspect,this.right*this.aspect,this.bottom,this.top,this.left,this.right)}get viewProjection(){return this.#$(),this.#z(),r(this.#q),o(this.#q,this.#W,this.#X),this.#q}}class E{ambColor=[0,0,0];ambK=.5;difColor=[.3,.3,.3];difK=.4;espColor=[1,1,1];espK=.1;espExp=20;pos;constructor(t){this.pos=t}createUniforms(t){t.setUniformValue("amb_c",this.ambColor,"3fv"),t.setUniformValue("amb_k",this.ambK,"1f"),t.setUniformValue("dif_c",this.difColor,"3fv"),t.setUniformValue("dif_k",this.difK,"1f"),t.setUniformValue("esp_c",this.espColor,"3fv"),t.setUniformValue("esp_k",this.espK,"1f"),t.setUniformValue("esp_p",this.espExp,"1f")}}class A{#H=[];#Z;#J;#Q;#tt=!1;get camera(){return this.#J}get light(){return this.#Z}constructor(t,e=[0,0,0,1]){if(t instanceof WebGL2RenderingContext){if(t.viewport(0,0,t.canvas.width,t.canvas.height),!e||!e.length||4!==e.length)throw new Error("The clear color need to be a array with 4 floats");t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.gl=t}}createCamera(t){this.#J=new T(t)}createLight(t){this.#Z=new E(t),this.#Q=new E(t),this.#Q.ambK=.3,this.#Q.difK=.4,this.#Q.espK=.3,this.#Q.ambColor=[.5,.5,.5]}appendElement(...t){t.forEach((t=>{if(!t.draw)throw new Error("Element need to have a draw function");this.#H.push(t),this.#Z&&t instanceof l&&this.#Z.createUniforms(t),this.#Z&&t instanceof P&&this.#Z.createUniforms(t.mesh)}))}switchLight(){if(!this.#Z)throw new Error("there is no lights to be switched.");this.#tt=!this.#tt;const t=this.#tt?this.#Q:this.#Z;this.#H.forEach((e=>{e instanceof l&&t.createUniforms(e),e instanceof P&&t.createUniforms(e.mesh)}))}draw(){for(let t of this.#H)t.draw(this.#J)}}class I{static rollDice(t){const e=[];for(let i=0;i<t;i++)e.push(Math.floor(6*Math.random())+1);return e}}class S{attackPlayer(t,e){const i=this.calcDices(t,!0),s=this.calcDices(e,!1);if(0===i)return alert("Ataque invalido");const r=I.rollDice(i),n=I.rollDice(s);let o=0,a=0;r.sort().reverse(),n.sort().reverse();for(let t=0;t<Math.min(i,s);t++)r[t]>n[t]?o++:a++;return t.soldiers-=a,e.soldiers-=o,o}calcDices(t,e){var i;return e?((i=t.soldiers-1)>3&&(i=3),i):((i=t.soldiers)>3&&(i=3),i)}getCountryObject(t){return this.countries.find((e=>e.name===t))}isValidCountry(t){return this.countries.includes(t)}}class k{#j;#et;#it;#st;#rt;#nt;#ot;#at;#ht=4;constructor(t,e,i,s){this.#j=t,this.#et=e,this.#it=[],this.#st=[],this.#at=[],this.#rt=i,this.#nt=0,this.#ot=s}conquestTerritory(t){this.#it.push(t)}lostTerritory(t){const e=this.#it.indexOf(t);this.#it.splice(e,1)}receiveCard(){this.#at.push(Math.floor(4*Math.random()))}receiveTroop(){let t=Math.floor(this.#it.length/2);t<3&&(t=3),this.#nt=t}addTroops(t,e){e<=this.#nt&&(t.soldiers=t.soldiers+e,this.#nt-=e)}attack(t,e){let i=0;return i=(new S).attackPlayer(t,e),0===e.soldiers&&(e.owner=this,e.changeColor()),i>0}exchangeCards(t,e,i){if(3===t.card||3===e.card||3===i.card||t.card===e.card&&t.card===e.card||t.card!==e.card&&e.card!==i.card&&i.card!==t.card){const s=[t.index,e.index,i.index],r=this.#at.filter(((t,e)=>-1===s.indexOf(e)));return this.#at=r,this.#nt+=this.#ht,this.#ht+=2,!0}return!1}get name(){return this.#j}get color(){return this.#et}get freeTroops(){return this.#nt}get territoriesOwned(){return this.#it.length}get vetTerritoriesOwned(){return this.#it}get vetContinentsOwned(){return this.#st}get goal(){return this.#rt.goal}get goalId(){return this.#rt.id}get goalPath(){return this.#rt.path}get continentsOwned(){return this.#ot.continentsOfPlayer(this)}get cards(){return this.#at}set cards(t){this.#at=t}}class L{#j;#lt;#ct;#N;constructor(t,e){this.#j=t,this.#lt=[],this.#ct=e,this.#N=null}addCountry(t){this.#lt.push(t)}get name(){return this.#j}get countries(){return this.#lt}get bonus(){return this.#ct}get owner(){return this.#N}set owner(t){this.#N=t}}class U{#ut;#lt;async init(t,e){this.#ut=[],this.#lt=[],await this.loadContinents(),await this.loadCountries(t,e)}async loadContinents(){const t=await fetch("./assets/data/continent-constructor.json"),e=await t.json();for(let t=0;t<e.data.length;t++){let i=new L(e.data[t].name,e.data[t].bonus);this.#ut.push(i)}}async loadCountries(t,e,i){const s=await fetch("./assets/data/country-constructor.json"),r=await s.json();for(let i=0;i<r.data.length;i++){const s=this.#ut.find((t=>t.name===r.data[i].continent));let n=new P(r.data[i].name,r.data[i].path,s,r.data[i].neighbors);await n.loadMesh(r.data[i].path,t,e,r.data[i].point),this.#lt.push(n)}}conquerCountry(t,e){countryFound=this.findCountry(t),countryFound||(countryFound.owner=e)}findCountry(t){for(let e=0;e<this.#lt;e++)if(this.#lt[e].name==t)return this.#lt[e];return null}get continents(){return this.#ut}get countries(){return this.#lt}troop_reassignment(t,e,i){if(!(t instanceof P&&e instanceof P&&"number"==typeof i))throw new Error("Parametro invalido");if(t.findNeighbor(e)){if(t.soldiers<=i)throw new Error("quantidade de tropas invalidas");t.soldiers-=i,e.soldiers+=i}}continentsOfPlayer(t){const e=[];for(const i of this.#ut)i.owner===t&&e.push(i.name);return e}clickedCountry(t,e,i){for(let s of this.#lt)if(s.mesh.pointCollision(t,e,i))return s;return null}}class R{#dt;#gt;#mt;#ft;#pt=!1;#wt=1;#_t=!1;static DISTRIBUCTION=0;static ATTACK=1;static REASSIGNMENT=2;static EXCHANGE_CARDS=3;constructor(t){this.#ft=t,this.#mt=-1,this.#dt=null,this.#gt="",this.nextPlayer()}nextPlayer(){this.#_t&&this.#ft[this.#mt].receiveCard(),this.#mt=this.#mt+1,this.#mt>=this.#ft.length&&(this.#wt++,this.#mt=0),this.#dt=R.DISTRIBUCTION,this.#ft[this.#mt].receiveTroop(),this.#_t=!1}set conquered(t){this.#_t=t}get player(){return this.#ft[this.#mt]}get state(){return this.#dt}get state_name(){let t;switch(this.#dt){case 0:default:t="Distribuição de Tropas";break;case 1:t="Fase de Ataque";break;case 2:t="Remanejo de Tropas";break;case 3:t="Troca de Cartas"}return this.#gt=t,this.#gt}get fortifyOpened(){return this.#pt}openFortify(){this.#pt=!0}closeFortify(){this.#pt=!1}nextState(t){0===this.#dt&&this.#ft[this.#mt].freeTroops>0?alert("Distribua todas as suas tropas"):(this.#dt+=1,t.gameScreen.changePlayer(t.turnsManager.player.name,t.turnsManager.state_name,t.turnsManager.player.color),(4===this.#dt||1===this.#wt&&1===this.#dt)&&(this.nextPlayer(),t.showCards.initCards(t.gl,t.turnsManager.player.cards),t.gameScreen.changePlayer(t.turnsManager.player.name,t.turnsManager.state_name,t.turnsManager.player.color),t.gameScreen.initGoal(t.gl,t.turnsManager.player),this.#dt=0))}}class D{#yt=null;#bt=!1;#vt=new Map;mapDebug(){this.#bt=!0}constructor(t){this.#vt.set(R.DISTRIBUCTION,new j),this.#vt.set(R.ATTACK,new O),this.#vt.set(R.REASSIGNMENT,new V);const e=new F;let i;t.showCards.initCards(t.gl,t.turnsManager.player.cards),t.gameScreen.initGoal(t.gl,t.turnsManager.player),t.gl.canvas.addEventListener("click",(async i=>{if(t.turnsManager.state===R.FREEZE)return;if(!t.inGame)return;const s=D.mapClickInCanvas(i.clientX,i.clientY,t.gl.canvas);if(t.showCards.opened&&await e.getCards(t,...s),t.fortify.opened)return void this.#vt.get(t.turnsManager.state).applyFort(t,...s);"cancel"===t.showCards.clickedWidget(...s)&&e.resetCards(t);const r=t.gameScreen.clickedWidget(...s);if("changeTurn"===r)return void t.turnsManager.nextState(t);"showCards"===r?t.showCards.up():"goal"===r&&t.gameScreen.moveGoal();const n=t.territoryController.clickedCountry(...s,t.gameScene.camera);if(n){alert(n.name),this.#yt=n,this.#vt.get(t.turnsManager.state).execute(t,n,...s);for(let e=0;e<t.players.length;e++){let i;if(t.players[e].goalId>=0&&t.players[e].goalId<=5?i=t.goal.verifyContinent(t.players[e]):6==t.players[e].goalId||7==t.players[e].goalId?i=t.goal.verifyTerritory(t.players[e]):t.players[e].goalId>=8&&t.players[e].goalId<=13&&(i=t.goal.verifyDestroy(t.players[e],t.players)),i){alert("Parabéns jogador "+t.players[e].name+", ganhaste!! ;)");break}}}})),document.body.addEventListener("keydown",(t=>{this.#bt&&("d"===t.key&&this.#yt&&(i=this.#yt.mesh.drawBorder,document.body.appendChild(i)),"s"===t.key&&document.body.removeChild(i))}))}static mapClickInCanvas(t,e,i){const s=[t-i.offsetLeft-i.width/2,i.height/2-(e-i.offsetTop)];return[2*s[0]/i.width,2*s[1]/i.height]}}class O{base=null;destiny=null;neighbors=null;amount=1;execute(t,e){const i=t.turnsManager.player,s=t.territoryController;if(this.base){if(-1===this.neighbors.indexOf(e))return;if(alert(`from ${this.base.name} to ${e.name}`),i.attack(this.base,e),t.tView.update(),0===e.soldiers)return t.fortify.changeNumber(1),t.fortify.up(),this.destiny=e,t.turnsManager.player.conquestTerritory(e),void(t.turnsManager.conquered=!0);this.resetPositions(t),this.base=null,this.neighbors=null}else{if(e.owner!==i)return;const r=s.countries.filter((t=>{if(-1!==e.neighbors.indexOf(t.name)&&t.owner!==e.owner)return t}));if(0===r.length)return;this.changePositions(t,e,r),this.base=e,this.neighbors=r}}applyFort(t,e,i){const s=t.fortify.clickedWidget(e,i);"-"===s&&this.amount>1?(this.amount--,t.fortify.changeNumber(this.amount)):"+"===s&&this.amount<this.base.soldiers-1?(this.amount++,t.fortify.changeNumber(this.amount)):"ok"===s&&(t.territoryController.troop_reassignment(this.base,this.destiny,this.amount),t.tView.update(),this.resetPositions(t),t.fortify.down(),t.fortify.changeNumber(0),this.amount=1,this.base=null,this.neighbors=null,this.destiny=null)}changePositions(t,e,i){t.gameScene.switchLight(),e.mesh.position[2]=.03,e.mesh.scale[2]=2,t.gameScene.light.createUniforms(e.mesh),i.forEach((e=>{e.mesh.position[2]=.03,e.mesh.scale[2]=2,t.gameScene.light.createUniforms(e.mesh)}))}resetPositions(t){t.gameScene.switchLight(),this.neighbors.forEach((e=>{e.mesh.position[2]=0,e.mesh.scale[2]=1,t.gameScene.light.createUniforms(e.mesh)})),this.base.mesh.position[2]=0,this.base.mesh.scale[2]=1}}class j{country=null;amount=0;execute(t,e){this.country||e.owner!==t.turnsManager.player||(t.gameScene.switchLight(),this.changePositions(t,e),t.fortify.up(),this.country=e,t.turnsManager.openFortify())}applyFort(t,e,i){const s=t.fortify.clickedWidget(e,i);"-"===s&&this.amount>0?(this.amount--,t.fortify.changeNumber(this.amount)):"+"===s&&this.amount<t.turnsManager.player.freeTroops?(this.amount++,t.fortify.changeNumber(this.amount)):"cancel"===s?(t.fortify.down(),this.resetPositions(t),t.amount=0,t.fortify.changeNumber(0)):"ok"===s&&(t.turnsManager.player.addTroops(this.country,this.amount),t.tView.update(),this.resetPositions(t),t.fortify.down(),t.fortify.changeNumber(0),this.amount=0)}changePositions(t,e){e.mesh.position[2]=.03,e.mesh.scale[2]=2,t.gameScene.light.createUniforms(e.mesh)}resetPositions(t){t.gameScene.switchLight(),this.country.mesh.position[2]=0,this.country.mesh.scale[2]=1,this.country=null}}class V{base=null;neighbors=null;destiny=null;amount=0;execute(t,e){const i=t.turnsManager.player,s=t.territoryController;if(this.base){if(!this.destiny){if(-1===this.neighbors.indexOf(e))return;this.destiny=e,t.fortify.up()}}else{if(e.owner!==i)return;const r=s.countries.filter((t=>{if(-1!==e.neighbors.indexOf(t.name)&&t.owner===e.owner)return t}));if(0===r.length)return;this.base=e,this.neighbors=r,this.changePositions(t,e,r)}}applyFort(t,e,i){const s=t.fortify.clickedWidget(e,i);"-"===s&&this.amount>0?(this.amount--,t.fortify.changeNumber(this.amount)):"+"===s&&this.amount+1<this.base.soldiers?(this.amount++,t.fortify.changeNumber(this.amount)):"cancel"!==s&&"ok"!==s||("ok"===s&&(t.territoryController.troop_reassignment(this.base,this.destiny,this.amount),t.tView.update()),this.resetPositions(t),t.fortify.down(),t.fortify.changeNumber(0),this.amount=0,this.base=null,this.neighbors=null,this.destiny=null)}changePositions(t,e,i){e.mesh.scale[2]=3,e.mesh.position[2]=.03,e.mesh.scale[2]=2,t.gameScene.switchLight(),t.gameScene.light.createUniforms(e.mesh),i.forEach((e=>{e.owner!==this.base.player&&(e.mesh.position[2]=.03,e.mesh.scale[2]=2,t.gameScene.light.createUniforms(e.mesh))}))}resetPositions(t){t.gameScene.switchLight(),this.neighbors.forEach((e=>{e.mesh.position[2]=0,e.mesh.scale[2]=1,t.gameScene.light.createUniforms(e.mesh)})),this.base.mesh.position[2]=0,this.base.mesh.scale[2]=1}}class F{#xt=[];execute(t,e,i){}async getCards(t,e,i){0===this.#xt.length&&(this.#xt=t.showCards.cards);const s=t.showCards.clickedWidget(e,i);if("ok"===s){const e=this.#xt.filter((t=>t.selected));if(e.length<3)return;return t.turnsManager.player.exchangeCards(...e),void await this.resetCards(t)}-1!==s&&"cancel"!==s&&(this.#xt[s].selected=!this.#xt[s].selected,this.#xt[s].selected?t.showCards.highlightCard(s):t.showCards.deshighlightCard(s))}async resetCards(t){for(let e=0;e<this.#xt.length;e++)t.showCards.deshighlightCard(e);this.#xt=[],t.showCards.down()}}class N extends u{#Ct;async init(t,e=1e3){const i=document.createElement("canvas"),s=i.toDataURL("image/png");[i.width,i.height]=[e,e],await super.init(t,s),this.#Ct=i}async update(t=(t=>{}),e){t(this.#Ct.getContext("2d"));const i=this.#Ct.toDataURL("image/png"),s=await u.loadImage(i);l.changeTex(e,this._tex,s)}clear(t=0,e=0,i=this.#Ct.width,s=this.#Ct.height){this.#Ct.getContext("2d").clearRect(t,e,i,s)}}class B{#Mt;#lt;#Pt;#Tt;async init(t,e,i){this.#lt=t,this.#Pt=i,this.#Tt=new N,await this.#Tt.init(i),this.#Tt.scale=[2.5,5],this.#Tt.depth=.1,await this.update(),this.#Mt=this.#Tt}async update(){this.#Tt.clear(0,0,this.#Pt.canvas.width,this.#Pt.canvas.height),await this.#Tt.update((t=>{t instanceof CanvasRenderingContext2D&&this.#lt.forEach((e=>{const i=e.pointMesh.center;t.fillStyle="white",t.font="30px Arial",t.fillText(e.soldiers+"",860*(i[0]+.5)+70,810*(.5-i[1])+95)}))}),this.#Pt)}draw(t){this.#Mt.draw(t)}}class G{#Et=[];#At;#It;get getGoal(){return this.#It}async loadGoals(){const t=await fetch("./assets/data/goals.json"),e=await t.json();this.#At=e.data.length;for(let t=0;t<this.#At;t++){let i=e.data[t];this.#Et.push(i)}}async sortGoal(t,e){const i=this.colorName(e);let s=Math.floor(Math.random()*this.#At);""==this.#Et[s].owner?8==this.#Et[s].id&&"azul"==i||9==this.#Et[s].id&&"amarelo"==i||10==this.#Et[s].id&&"vermelho"==i||11==this.#Et[s].id&&"preto"==i||12==this.#Et[s].id&&"branco"==i||13==this.#Et[s].id&&"verde"==i?this.sortGoal(t,e):(this.#Et[s].owner=t,this.#It=this.#Et[s]):this.sortGoal(t,e)}verifyDestroy(t,e){let i;switch(t.goalId){case 8:i="azul";break;case 9:i="amarelo";break;case 10:i="vermelho";break;case 11:i="preto";break;case 12:i="branco";break;case 13:i="verde";break;default:i=""}if(""==i)return!1;for(let t=0;t<e.length;t++)if(this.colorName(e[t].color)==i&&0!=e[t].territoriesOwned)return!1;return!0}verifyContinent(t){let e,i=[],s=!1;switch(t.goalId){case 0:e=3,i=["Europa","Oceania"];break;case 1:e=2,i=["Ásia","América do Sul"];break;case 2:e=3,i=["Europa","América do Sul"];break;case 3:e=2,i=["Ásia","África"];break;case 4:e=2,i=["América do Norte","África"];break;case 5:e=2,i=["América do Norte","Oceania"]}return t.continentsOwned>=e&&(s=i.every((e=>t.vetContinentsOwned.includes(e)))),s}verifyTerritory(t){let e,i,s;switch(t.goalId){case 6:e=18,i=2;break;case 7:e=24,i=1}if(t.territoriesOwned>=e)for(let e=0;e<t.territoriesOwned;e++){if(!(t.vetTerritoriesOwned[e].soldiers>=i))return!1;s=!0}return s}colorName(t){return"0,0,1,1"==`${t}`?"azul":"1,1,0,1"==`${t}`?"amarelo":"1,0,0,1"==`${t}`?"vermelho":"1,1,1,1"==`${t}`?"preto":"0,0,0,1"==`${t}`?"branco":"0,0.4,0,1"==`${t}`?"verde":void 0}}class Y{#St;#kt;#Lt;#Ut;#Rt;#ot;#Dt=4.5;#Ot=!1;#jt=!1;#ft=[];#Vt;#Ft;#Nt;#Bt;#Gt;#rt;#Yt;get tView(){return this.#Rt}get goal(){return this.#rt}get inGame(){return this.#Ot}get gameScene(){return this.#kt}get turnsManager(){return this.#Vt}get territoryController(){return this.#ot}get showCards(){return this.#Gt}get fortify(){return this.#Nt}get gameScreen(){return this.#Bt}get guiScene(){return this.#Lt}get players(){return this.#ft}static async build(t){const e=new Y;return await e.init(t),e}async init(t){this.gl=t.getContext("webgl2"),await this.#Xt();const e=["Player 1","Player 2"],i=[[0,0,1,1],[1,1,0,1],[1,0,0,1],[1,1,1,1],[0,0,0,1],[0,.4,0,1]];this.#rt=new G,await this.#rt.loadGoals(),this.#ot=new U;for(let t=0;t<e.length;t++){const s=Math.floor(Math.random()*i.length),r=i[s];this.#rt.sortGoal(e[5-t],r);let n=this.#rt.getGoal;i.splice(s,1),this.#Yt=n.path,this.#ft[t]=new k(e[t],r,n,this.#ot)}await this.#ot.init(this.gl,this.#Dt);const s=[...this.#ot.countries],r=Math.floor(s.length/this.#ft.length);for(let t of this.#ft)for(let e=0;e<r&&s.length;e++){const e=Math.floor(Math.random()*s.length);s[e].owner=t,s[e].soldiers=1,t.conquestTerritory(s[e]),s.splice(e,1)}this.#Vt=new R(this.#ft,this),await this.#Wt(),this.#Ft=new D(this)}async#Xt(){this.#St=new A(this.gl);const t=new u;await t.init(this.gl,"./assets/menu/fundo.jpg");const e=new u;await e.init(this.gl,"./assets/menu/logo_war.png");const i=new u;await i.init(this.gl,"./assets/menu/play_button.png");const s=new u;await s.init(this.gl,"./assets/menu/settings_button.png");const r=new u;await r.init(this.gl,"./assets/menu/max_button.png"),t.scaleY=1.85,e.scale=[.35,.56],i.scale=[.15,.26],s.scale=[.046,.08],r.scale=[.046,.08],e.positionY=.25,i.positionY=-.55,s.positionX=.9,s.positionY=.8,this.#St.appendElement(t,e,i,s),this.gl.canvas.addEventListener("click",(t=>{const e=Y.mapClickInCanvas(t.clientX,t.clientY,this.gl.canvas);i.pointCollision(...e)&&(this.#Ot||(this.#jt=!0))}))}async#Wt(){const t=new u;await t.init(this.gl,"./assets/game/fundo.jpg"),t.scaleY=1.85,t.scaleX=1.01,t.depth=-.01,this.#Ut=t;const e=new X;await e.init(this.gl,this.#Vt),this.#Bt=e;const i=new W;await i.init(this.gl),this.#Gt=i;const s=new q;await s.init(this.gl),this.#Nt=s,this.#kt=new A(this.gl),this.#kt.createCamera(K),this.#kt.camera.camPosition[2]=1.8,this.#kt.createLight([1,0,.3]),this.#Lt=new A(this.gl),this.#Rt=new B,await this.#Rt.init(this.#ot.countries,this.#Dt,this.gl),this.#kt.appendElement(...this.#ot.countries),this.#Lt.appendElement(e,i,s),this.#kt.appendElement(this.#Rt);for(let t of this.#ot.countries)t.loadUniforms(this.#kt.camera)}logic(){this.#Nt.logic(),this.#Gt.logic()}draw(){this.#Ot?(this.#Ut.draw(),this.#kt.draw(),this.#Lt.draw()):this.#St.draw()}run(){const t=()=>{this.logic(),this.draw(),this.#jt&&(this.#Ot=!0,this.#jt=!1),requestAnimationFrame(t)};t()}static mapClickInCanvas(t,e,i){const s=[t-i.offsetLeft-i.width/2,i.height/2-(e-i.offsetTop)];return[2*s[0]/i.width,2*s[1]/i.height]}}class X{#Pt;async init(t,e){this.settingsButton=new u,await this.settingsButton.init(t,"./assets/menu/settings_button.png"),this.settingsButton.scale=[.046,.08],X.setInitialPosition(.9,.8,.2,this.settingsButton),this.card_button=new u,await this.card_button.init(t,"./assets/game/card_button.png"),this.card_button.scale=[.08,.15],X.setInitialPosition(.76,-.85,.2,this.card_button),this.objective_button=new u,await this.objective_button.init(t,"./assets/game/objective_button.png"),this.objective_button.scale=[.065,.11],X.setInitialPosition(.92,-.85,.2,this.objective_button),this.current_player=new u,await this.current_player.init(t,"./assets/game/current_player1.png"),this.current_player.scale=[.4,.6],X.setInitialPosition(0,-.85,.2,this.current_player),this.current_player_text=new N,await this.current_player_text.init(t),this.changePlayer(e.player.name,"Distribuição de tropas",e.player.color),this.current_player_text.scale=[.4,.3],this.current_player_text.positionY=-.85,this.show_players=new u,await this.show_players.init(t,"./assets/game/show_players.png"),this.show_players.scale=[.065,.115],X.setInitialPosition(-.92,-.85,.2,this.show_players),this.changeStateBtn=new u,await this.changeStateBtn.init(t,"./assets/game/next_turn.png"),this.changeStateBtn.scale=[.065,.11],X.setInitialPosition(.6,-.85,.2,this.changeStateBtn),this.#Pt=t}async initGoal(t,e){this.goal=new u,await this.goal.init(t,e.goalPath),this.goal.scale=[.4,.6],X.setInitialPosition(this.goal.positionX,this.goal.positionY,.4,this.goal)}static setInitialPosition(t,e,i,s){s.positionX=t,s.positionY=e,s.depth=i}moveAll(t){this.card_button.positionY+=t,this.objective_button._tex.positionY+=t,this.current_player.positionY+=t}moveGoal(){0===this.goal.positionX?this.goal.positionX=10:this.goal.positionX=0}draw(t){this.settingsButton.draw(t),this.card_button.draw(t),this.objective_button.draw(t),this.current_player.draw(t),this.current_player_text.draw(t),this.show_players.draw(t),this.changeStateBtn.draw(t),this.goal.draw(t)}clickedWidget(t,e){return this.changeStateBtn.pointCollision(t,e)?"changeTurn":this.card_button.pointCollision(t,e)?"showCards":this.objective_button.pointCollision(t,e)?"goal":void 0}changePlayer(t,e,i){this.current_player_text.clear();const s=i.map((t=>Math.round(255*t)));this.current_player_text.update((i=>{i instanceof CanvasRenderingContext2D&&(i.fillStyle=`rgb(${s})`.replaceAll("'",""),i.font="200px Arial",i.fillText("Vez do "+t,300,210,400),i.fillStyle="white",i.fillText(e,185,650,650))}),this.#Pt)}}class W{#qt=!1;#Kt=!1;#$t=0;#zt=0;#at;#Ht;get opened(){return!this.#qt&&1===this.#zt}get cards(){const t=[];for(let e=0;e<this.#at.length;e++)t.push({card:this.#Ht[e],index:e,selected:!1});return t}async init(t){this.show_cards=new u,await this.show_cards.init(t,"./assets/game/show_cards.png"),this.show_cards.scale=[.4,.7],W.setInitialPosition(this.show_cards.positionX,-1.85,.3,this.show_cards),this.cancel_button=new u,await this.cancel_button.init(t,"./assets/game/cancel_button.png"),this.cancel_button.scale=[.046,.083],W.setInitialPosition(-.34,-1.81,.4,this.cancel_button),this.ok_button=new u,await this.ok_button.init(t,"./assets/game/ok_button.png"),this.ok_button.scale=[.046,.083],W.setInitialPosition(.34,-1.81,.4,this.ok_button),this.cards_info=new u,await this.cards_info.init(t,"assets/game/cards_info.png"),this.cards_info.scale=[.2,.35],W.setInitialPosition(.832+1,this.cards_info.positionY,.3,this.cards_info)}async initCards(t,e){this.#at=[],this.#Ht=e;let i=0;if(e.length>0){for(let i=0;i<e.length;i++){const s=new u;0==e[i]?await s.init(t,"./assets/game/cards/square.png"):1==e[i]?await s.init(t,"./assets/game/cards/circle.png"):2==e[i]?await s.init(t,"./assets/game/cards/triangle.png"):3==e[i]&&await s.init(t,"./assets/game/cards/joker.png"),this.#at.push(s)}for(let t=0;t<this.#at.length;t++)this.#at[t].scale=[.055,.095],W.setInitialPosition(-.161+i,-1.85,.4,this.#at[t]),i+=.08}this.cardsNumber=new N,await this.cardsNumber.init(t,500),this.cardsNumber.update((t=>{t instanceof CanvasRenderingContext2D&&(t.fillStyle="black",t.font="30px Arial",t.fillText(this.#at.length.toString(),250,250))}),t),this.cardsNumber.scale=[.8,1.8],W.setInitialPosition(.74,-.94,.5,this.cardsNumber)}static setInitialPosition(t,e,i,s){s.positionX=t,s.positionY=e,s.depth=i}moveAll(t,e){if(this.cards_info.positionX+=t,this.cancel_button.positionY+=e,this.ok_button.positionY+=e,this.show_cards.positionY+=e,this.#at.length>0)for(let t=0;t<this.#at.length;t++)this.#at[t].positionY+=e}draw(t){if(this.show_cards.draw(t),this.cancel_button.draw(t),this.ok_button.draw(t),this.cards_info.draw(t),this.cardsNumber.draw(t),this.#at.length>0)for(let e=0;e<this.#at.length;e++)this.#at[e].draw(t)}up(){this.#qt=!0,this.#Kt=!1}down(){this.#Kt=!0,this.#qt=!1}logic(){const t=.01;(this.#qt||this.#Kt)&&(this.#qt?(this.#zt+=t,this.#$t-=t,this.#zt>=1?(this.#zt=1,this.#$t=0,this.#qt=!1):this.moveAll(-.01,t)):this.#Kt&&(this.#zt-=t,this.#$t+=t,this.#zt<=0?(this.#zt=0,this.#$t=1,this.#Kt=!1):this.moveAll(t,-.01)))}clickedWidget(t,e){if(this.#at.length>0)for(let i=0;i<this.#at.length;i++)if(this.#at[i].pointCollision(t,e)){let t="";return 0==this.#Ht[i]?t="square":1==this.#Ht[i]?t="circle":2==this.#Ht[i]?t="triangle":3==this.#Ht[i]&&(t="joker"),i}return this.cancel_button.pointCollision(t,e)?"cancel":this.ok_button.pointCollision(t,e)?"ok":-1}highlightCard(t){this.#at[t].scale=[.065,.105]}deshighlightCard(t){this.#at[t].scale=[.055,.095]}}class q{#qt=!1;#zt=0;#Pt;#Kt=!1;get opened(){return!this.#qt&&1===this.#zt}async init(t){this.fortify=new u,await this.fortify.init(t,"./assets/game/fortify.png"),this.fortify.scale=[.4,.7],q.setInitialPosition(this.fortify.positionX,-1.825,.3,this.fortify),this.cancel_button=new u,await this.cancel_button.init(t,"./assets/game/cancel_button.png"),this.cancel_button.scale=[.046,.083],q.setInitialPosition(-.34,-1.81,.4,this.cancel_button),this.ok_button=new u,await this.ok_button.init(t,"./assets/game/ok_button.png"),this.ok_button.scale=[.046,.083],q.setInitialPosition(.34,-1.81,.4,this.ok_button),this.plus_button=new u,await this.plus_button.init(t,"./assets/game/plus_button.png"),this.plus_button.scale=[.046,.083],q.setInitialPosition(.168,-.86-1,.4,this.plus_button),this.minus_button=new u,await this.minus_button.init(t,"./assets/game/minus_button.png"),this.minus_button.scale=[.046,.083],q.setInitialPosition(-.168,-.86-1,.4,this.minus_button),this.numberImage=new N,await this.numberImage.init(t,500),this.numberImage.update((t=>{t instanceof CanvasRenderingContext2D&&(t.fillStyle="white",t.font="30px Arial",t.fillText("0",250,250))}),t),this.numberImage.depth=.5,this.numberImage.scaleY=1.5,q.setInitialPosition(-.05,-.86-1,.4,this.numberImage),this.#Pt=t}static setInitialPosition(t,e,i,s){s.positionX=t,s.positionY=e,s.depth=i}moveAll(t){this.fortify.positionY+=t,this.cancel_button.positionY+=t,this.ok_button.positionY+=t,this.plus_button.positionY+=t,this.minus_button.positionY+=t,this.numberImage.positionY+=t}up(){this.#qt=!0,this.#Kt=!1}down(){this.#Kt=!0,this.#qt=!1}logic(){const t=.01;(this.#qt||this.#Kt)&&(this.#qt?(this.#zt+=t,this.#zt>=1?(this.#zt=1,this.#qt=!1):this.moveAll(t)):this.#Kt&&(this.#zt-=t,this.#zt<=0?(this.#zt=0,this.#Kt=!1):this.moveAll(-.01)))}draw(t){this.fortify.draw(t),this.cancel_button.draw(t),this.ok_button.draw(t),this.plus_button.draw(t),this.minus_button.draw(t),this.numberImage.draw(t)}clickedWidget(t,e){return this.cancel_button.pointCollision(t,e)?"cancel":this.ok_button.pointCollision(t,e)?"ok":this.plus_button.pointCollision(t,e)?"+":this.minus_button.pointCollision(t,e)?"-":void 0}changeNumber(t){this.numberImage.clear(),this.numberImage.update((e=>{e instanceof CanvasRenderingContext2D&&(e.fillStyle="white",e.font="30px Arial",e.fillText(""+t,250,250))}),this.#Pt)}}const K=document.querySelector("#game-screen");Y.build(K).then((t=>{t.run()}))})();
//# sourceMappingURL=main.bundle.js.map