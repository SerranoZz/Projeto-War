(()=>{"use strict";var t=1e-6,e="undefined"!=typeof Float32Array?Float32Array:Array;function i(){var t=new e(16);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function r(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function o(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s(t,e,i){var r=e[0],o=e[1],s=e[2],n=e[3],a=e[4],h=e[5],c=e[6],l=e[7],f=e[8],m=e[9],u=e[10],g=e[11],d=e[12],p=e[13],_=e[14],v=e[15],x=i[0],w=i[1],E=i[2],M=i[3];return t[0]=x*r+w*a+E*f+M*d,t[1]=x*o+w*h+E*m+M*p,t[2]=x*s+w*c+E*u+M*_,t[3]=x*n+w*l+E*g+M*v,x=i[4],w=i[5],E=i[6],M=i[7],t[4]=x*r+w*a+E*f+M*d,t[5]=x*o+w*h+E*m+M*p,t[6]=x*s+w*c+E*u+M*_,t[7]=x*n+w*l+E*g+M*v,x=i[8],w=i[9],E=i[10],M=i[11],t[8]=x*r+w*a+E*f+M*d,t[9]=x*o+w*h+E*m+M*p,t[10]=x*s+w*c+E*u+M*_,t[11]=x*n+w*l+E*g+M*v,x=i[12],w=i[13],E=i[14],M=i[15],t[12]=x*r+w*a+E*f+M*d,t[13]=x*o+w*h+E*m+M*p,t[14]=x*s+w*c+E*u+M*_,t[15]=x*n+w*l+E*g+M*v,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var n;class a{static createShader(t,e,i){const r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(r);throw new Error("Shader compilation error: "+e)}return r}static createProgram(t,e,i){const r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS)){const e=t.getProgramInfoLog(r);throw new Error("Could not compile WebGL program:"+e)}return r}static createBuffer(t,e,i){if(0==i.length)return null;if(!(i&&i.buffer instanceof ArrayBuffer&&void 0!==i.byteLength))return console.warn("Data is not an instance of ArrayBuffer"),null;const r=t.createBuffer();return t.bindBuffer(e,r),t.bufferData(e,i,t.STATIC_DRAW),r}static createVAO(t,...e){if(!(t instanceof WebGL2RenderingContext))return;const i=t.createVertexArray();let r,o;t.bindVertexArray(i);for(let i of e)null!=i.loc&&null!=i.loc&&(t.enableVertexAttribArray(i.loc),r=i.dimension,o=t.FLOAT,t.bindBuffer(t.ARRAY_BUFFER,i.buffer),t.vertexAttribPointer(i.loc,r,o,!1,0,0));return i}}class h{_gl;position=[0,0,0];rotation=[0,0,0];scale=[1,1,1];static#t=0;#e=i();#i=[];#r=null;#o=null;_program=null;_primitive;#s;_vaoLoc;#n;#a;_useModelMatrix=!0;get modelMatrix(){return this._updateModelMatrix(),this.#e}set useModelMatrix(t){if(!(t instanceof Boolean))throw new Error("useModelMatrix need to be a boolean value");this._useModelMatrix=t}addAttribute(t,e,i=4){if(!(e instanceof Array))throw new Error("The info parameter needs to be a Array.");e.forEach((t=>{if("number"!=typeof t)throw new Error("The info array need to be numeric.")}));const r=e.length/i;if(this.#s){if(r!==this.#s)throw new Error("The VBOs need to contain the same number of vertex.")}else this.#s=r;const o=new Float32Array(e);this.#i.push({loc:this._gl.getAttribLocation(this._program,t),buffer:a.createBuffer(this._gl,this._gl.ARRAY_BUFFER,o),dimension:i})}constructor(t,e,i,r){this._primitive=r,this._gl=t,this.createShader(e,i)}createShader(t,e){this.#r=a.createShader(this._gl,this._gl.VERTEX_SHADER,t),this.#o=a.createShader(this._gl,this._gl.FRAGMENT_SHADER,e),this._program=a.createProgram(this._gl,this.#r,this.#o),this._gl.useProgram(this._program)}createVAO(){this._vaoLoc=a.createVAO(this._gl,...this.#i)}_updateModelMatrix(){var t,e,i,r,s,n,a,h,c,l,f,m,u,g,d,p,_,v;o(this.#e),t=this.#e,e=this.#e,p=(i=this.position)[0],_=i[1],v=i[2],e===t?(t[12]=e[0]*p+e[4]*_+e[8]*v+e[12],t[13]=e[1]*p+e[5]*_+e[9]*v+e[13],t[14]=e[2]*p+e[6]*_+e[10]*v+e[14],t[15]=e[3]*p+e[7]*_+e[11]*v+e[15]):(r=e[0],s=e[1],n=e[2],a=e[3],h=e[4],c=e[5],l=e[6],f=e[7],m=e[8],u=e[9],g=e[10],d=e[11],t[0]=r,t[1]=s,t[2]=n,t[3]=a,t[4]=h,t[5]=c,t[6]=l,t[7]=f,t[8]=m,t[9]=u,t[10]=g,t[11]=d,t[12]=r*p+h*_+m*v+e[12],t[13]=s*p+c*_+u*v+e[13],t[14]=n*p+l*_+g*v+e[14],t[15]=a*p+f*_+d*v+e[15]),function(t,e,i){var r=Math.sin(i),o=Math.cos(i),s=e[4],n=e[5],a=e[6],h=e[7],c=e[8],l=e[9],f=e[10],m=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*o+c*r,t[5]=n*o+l*r,t[6]=a*o+f*r,t[7]=h*o+m*r,t[8]=c*o-s*r,t[9]=l*o-n*r,t[10]=f*o-a*r,t[11]=m*o-h*r}(this.#e,this.#e,this.rotation[0]),function(t,e,i){var r=Math.sin(i),o=Math.cos(i),s=e[0],n=e[1],a=e[2],h=e[3],c=e[8],l=e[9],f=e[10],m=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*o-c*r,t[1]=n*o-l*r,t[2]=a*o-f*r,t[3]=h*o-m*r,t[8]=s*r+c*o,t[9]=n*r+l*o,t[10]=a*r+f*o,t[11]=h*r+m*o}(this.#e,this.#e,this.rotation[1]),function(t,e,i){var r=Math.sin(i),o=Math.cos(i),s=e[0],n=e[1],a=e[2],h=e[3],c=e[4],l=e[5],f=e[6],m=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*o+c*r,t[1]=n*o+l*r,t[2]=a*o+f*r,t[3]=h*o+m*r,t[4]=c*o-s*r,t[5]=l*o-n*r,t[6]=f*o-a*r,t[7]=m*o-h*r}(this.#e,this.#e,this.rotation[2]),function(t,e,i){var r=i[0],o=i[1],s=i[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this.#e,this.#e,this.scale)}createTex(t,e){return this.#n=this._gl.getUniformLocation(this._program,e),this.#a=this._gl.createTexture(),this._gl.activeTexture(this._gl[`TEXTURE${h.#t}`]),this._gl.bindTexture(this._gl.TEXTURE_2D,this.#a),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA32F,this._gl.RGBA,this._gl.FLOAT,t),this._gl.useProgram(this._program),this._gl.uniform1i(this.#n,h.#t),h.#t++,{tex:this.#a,index:h.#t-1}}setUniformValue(t,e,i){const r=this._gl.getUniformLocation(this._program,t);if(-1===r)throw new Error("This uniform doesn't exist in the shader code.");this._gl.useProgram(this._program),i.startsWith("Matrix")?this._gl["uniform"+i](r,!1,e):this._gl["uniform"+i](r,e)}draw(t){this._gl.frontFace(this._gl.CCW),this._gl.enable(this._gl.CULL_FACE),this._gl.cullFace(this._gl.BACK),this._updateModelMatrix(),this._gl.bindVertexArray(this._vaoLoc),this._gl.useProgram(this._program);const e=this._gl.getUniformLocation(this._program,"model"),o=this._gl.getUniformLocation(this._program,"modelView"),n=this._gl.getUniformLocation(this._program,"mvp");if(e)this._gl.uniformMatrix4fv(e,!1,this.#e);else if(o){const e=i();t?s(e,t.viewMatrix,this.#e):r(e,this.#e),this._gl.uniformMatrix4fv(o,!1,e)}else if(n){const e=i();t?s(e,t.viewProjection,this.#e):r(e,this.#e),this._gl.uniformMatrix4fv(n,!1,e)}this._gl.drawArrays(this._primitive,0,this.#s),this._gl.disable(this._gl.CULL_FACE)}static changeTex(t,{tex:e,index:i},r){t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,t.RGBA,t.FLOAT,r)}}n=new e(3),e!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0);class c{#h;#c;#l;set scaleX(t){if(t<=0)throw new Error("the scale of a image need to be greater than 0");this.#h.scale[0]=t}set scaleY(t){if(t<=0)throw new Error("the scale of a image need to be greater than 0");this.#h.scale[1]=t}set positionX(t){this.#h.position[0]=t}set positionY(t){this.#h.position[1]=t}set depth(t){this.#h.position[2]=t}set rotation(t){this.#h.rotation[2]=t}set scale(t){if(!(t instanceof Array)||2!==t.length)throw new Error("scale need to be a vector with two positions.");this.#h.scale=function(t,i,r){var o=new e(3);return o[0]=t,o[1]=i,o[2]=1,o}(t[0],t[1])}set opacity(t){this.#h.setUniformValue("alpha",t,"1f")}async init(t,e){this.#h=new h(t,"#version 300 es\n    precision highp float;\n\n    uniform mat4 mvp;\n\n    in vec4 position;\n    in vec2 texCoord;\n\n    out vec2 fTexCoord;\n\n    void main() {\n        gl_Position  = mvp * position;\n        fTexCoord = texCoord;\n    }\n","#version 300 es\n    precision highp float;\n    \n    in vec2 fTexCoord;\n\n    uniform sampler2D uTexture;\n    uniform float alpha;\n\n    out vec4 color;\n\n    void main() {\n        color = texture(uTexture, fTexCoord);\n\n        if(color.a < 0.2) discard;\n\n        color *= alpha;\n    }\n",t.TRIANGLES);const i=await this.#f(e),r=this.#m(...i);this.#h.addAttribute("position",r.coords),this.#h.addAttribute("texCoord",r.texCoords,2),this.#h.createVAO(),this.opacity=1}static async loadImage(t){return new Promise((e=>{const i=new Image;i.addEventListener("load",(()=>{e(i)})),i.src=t}))}async#f(t){const e=await c.loadImage(t);await e.decode();const i=await createImageBitmap(e);return this._tex=this.#h.createTex(e,"uTexture"),[i.width,i.height]}#m(t,e){const i=t/e;let r=1,o=1;i<1?r*=i:o/=i,this.#c=r,this.#l=o;const s=[-r,-o,0,1],n=[r,-o,0,1],a=[r,o,0,1],h=[-r,o,0,1];return{coords:[...s,...n,...a,...s,...a,...h],texCoords:[0,1,1,1,1,0,0,1,1,0,0,0]}}pointCollision(t,e,o){const n=[t,e,0,1],a=i();r(a,this.#h.modelMatrix),o&&s(a,o.viewProjection,a);const h=i();!function(t,e){var i=e[0],r=e[1],o=e[2],s=e[3],n=e[4],a=e[5],h=e[6],c=e[7],l=e[8],f=e[9],m=e[10],u=e[11],g=e[12],d=e[13],p=e[14],_=e[15],v=i*a-r*n,x=i*h-o*n,w=i*c-s*n,E=r*h-o*a,M=r*c-s*a,b=o*c-s*h,T=l*d-f*g,A=l*p-m*g,P=l*_-u*g,y=f*p-m*d,R=f*_-u*d,L=m*_-u*p,U=v*L-x*R+w*y+E*P-M*A+b*T;U&&(U=1/U,t[0]=(a*L-h*R+c*y)*U,t[1]=(o*R-r*L-s*y)*U,t[2]=(d*b-p*M+_*E)*U,t[3]=(m*M-f*b-u*E)*U,t[4]=(h*P-n*L-c*A)*U,t[5]=(i*L-o*P+s*A)*U,t[6]=(p*w-g*b-_*x)*U,t[7]=(l*b-m*w+u*x)*U,t[8]=(n*R-a*P+c*T)*U,t[9]=(r*P-i*R-s*T)*U,t[10]=(g*M-d*w+_*v)*U,t[11]=(f*w-l*M-u*v)*U,t[12]=(a*A-n*y-h*T)*U,t[13]=(i*y-r*A+o*T)*U,t[14]=(d*x-g*E-p*v)*U,t[15]=(l*E-f*x+m*v)*U)}(h,a);const c=function(t,e){const i=new Array(e.length).fill(0);if(Math.round(e.length**2)===t.length){for(let r=0;r<e.length;r++)for(let o=0;o<t.length;o+=4)i[r]+=t[o+r]*e[o/4];return i}}(h,n);return Math.abs(c[0])<this.#c&&Math.abs(c[1])<this.#l}draw(t){this.#h&&this.#h.draw(t)}}class l{#u=i();#g=i();#d=i();camPosition=[0,0,1];lookDirection=[0,0,0];upDirection=[0,1,0];left=-4;right=4;bottom=-4;top=4;near=1;far=9;fovy=Math.PI/2;aspect;constructor(t){this.aspect=t.width/t.height}#p="perspective";set projectionType(t){if("orthogonal"!==t&&"perspective"!==t)throw new Error("Invalid type of projection.");this.#p=t}get viewMatrix(){return this.#_(),this.#u}get projMatrix(){return this.#v(),this.#g}#_(){o(this.#u),function(e,i,r,s){var n,a,h,c,l,f,m,u,g,d,p=i[0],_=i[1],v=i[2],x=s[0],w=s[1],E=s[2],M=r[0],b=r[1],T=r[2];Math.abs(p-M)<t&&Math.abs(_-b)<t&&Math.abs(v-T)<t?o(e):(m=p-M,u=_-b,g=v-T,n=w*(g*=d=1/Math.hypot(m,u,g))-E*(u*=d),a=E*(m*=d)-x*g,h=x*u-w*m,(d=Math.hypot(n,a,h))?(n*=d=1/d,a*=d,h*=d):(n=0,a=0,h=0),c=u*h-g*a,l=g*n-m*h,f=m*a-u*n,(d=Math.hypot(c,l,f))?(c*=d=1/d,l*=d,f*=d):(c=0,l=0,f=0),e[0]=n,e[1]=c,e[2]=m,e[3]=0,e[4]=a,e[5]=l,e[6]=u,e[7]=0,e[8]=h,e[9]=f,e[10]=g,e[11]=0,e[12]=-(n*p+a*_+h*v),e[13]=-(c*p+l*_+f*v),e[14]=-(m*p+u*_+g*v),e[15]=1)}(this.#u,this.camPosition,this.lookDirection,this.upDirection)}#v(){o(this.#g),"perspective"===this.#p?function(t,e,i,r,o){var s,n=1/Math.tan(e/2);t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(s=1/(r-o),t[10]=(o+r)*s,t[14]=2*o*r*s):(t[10]=-1,t[14]=-2*r)}(this.#g,this.fovy,this.aspect,this.near,this.far):function(t,e,i,r,o,s,n){var a=1/(e-i),h=1/(r-o),c=1/(s-n);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(o+r)*h,t[14]=(n+s)*c,t[15]=1}(this.#g,this.left*this.aspect,this.right*this.aspect,this.bottom,this.top,this.left,this.right)}get viewProjection(){return this.#_(),this.#v(),o(this.#d),s(this.#d,this.#g,this.#u),console.log(this.aspect,this.fovy,this.near,this.#p),this.#d}}class f{attributes=new Map;id;hEdge;constructor(t){this.id=t}}class m{opositte;next;vertex;constructor(t){this.vertex=t}}class u{hEdge;constructor(t){this.hEdge=t}}class g{#x=[];#w=[];#E=[];constructor(t){for(let e=0;e<t.length;e+=3){const i=t[e],r=t[e+1],o=t[e+2];this.#w[i]||(this.#w[i]=new f(i)),this.#w[r]||(this.#w[r]=new f(r)),this.#w[o]||(this.#w[o]=new f(o));const s=new m(this.#w[i]),n=new m(this.#w[r]),a=new m(this.#w[o]);s.next=n,n.next=a,a.next=s;const h=new u(s);this.#x[e]=s,this.#x[e+1]=n,this.#x[e+2]=a,this.#E[Math.round(e/3)]=h}this.setOposittes()}setOposittes(){for(let t of this.#x){const e=t.vertex,i=t.next.vertex;if(e.hEdge||(e.hEdge=t),!t.opositte)for(let r of this.#x)if(r.vertex===i&&r.next.vertex===e){t.opositte=r,r.opositte=t;break}}}setAttribute(t,e,i){if(t.length/e!==this.#w.length)throw new Error(`Mesh haves ${this.#w.length} vertices, but only ${t.length/e} were given.`);for(let r=0;r<t.length;r+=e){const o=t.slice(r,r+e);this.#w[Math.round(r/e)].attributes.set(i,o)}}createVBOs(){const t=new Map,e=[];for(let e of this.#w)for(let i of e.attributes.keys())t.get(i)||t.set(i,[]),t.get(i).push(...e.attributes.get(i));for(let t of this.#x)e.push(t.vertex.id);return{attributes:t,indexes:e,count:this.#w.length}}}class d extends h{#M;#b=-1;constructor(t,e,i,r){super(t,e,i,t.TRIANGLES),this.#M=new g(r)}addAttribute(t,e,i=4){if(!(e instanceof Array))throw new Error("The info parameter needs to be a Array.");if(e.forEach((t=>{if("number"!=typeof t)throw new Error("The info array need to be numeric.")})),-1===this._gl.getAttribLocation(this._program,t))throw new Error(`the attribute ${t} doesn't exists in the shader code.`);this.#M.setAttribute(e,i,t)}createVAO(){const t=this.#M.createVBOs(),e=Array.from(t.attributes.entries()).map((e=>({loc:this._gl.getAttribLocation(this._program,e[0]),buffer:a.createBuffer(this._gl,this._gl.ARRAY_BUFFER,new Float32Array(e[1])),dimension:Math.round(e[1].length/t.count)})));this._vaoLoc=a.createVAO(this._gl,...e),this.#b=a.createBuffer(this._gl,this._gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.indexes)),this._count=t.indexes.length}draw(t){if(!(this._gl instanceof WebGL2RenderingContext))return;this._gl.frontFace(this._gl.CCW),this._gl.enable(this._gl.CULL_FACE),this._gl.cullFace(this._gl.BACK),this._gl.bindVertexArray(this._vaoLoc),this._gl.useProgram(this._program),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.#b);const e=this._gl.getUniformLocation(this._program,"model"),r=this._gl.getUniformLocation(this._program,"modelView"),o=this._gl.getUniformLocation(this._program,"mvp");if(e)this._gl.uniformMatrix4fv(e,!1,this.modelMatrix);else if(r){const r=i();s(r,t.viewMatrix,this.modelMatrix),this._gl.uniformMatrix4fv(e,!1,r)}else if(o){const r=i();s(r,t.viewProjection,this.modelMatrix),this._gl.uniformMatrix4fv(e,!1,r)}this._gl.drawElements(this._primitive,this._count,this._gl.UNSIGNED_INT,0),this._gl.disable(this._gl.CULL_FACE)}static async loadMeshFromObj(t,e,i,r,o){const s=await fetch(t),n=await s.text(),a=new Map,h=n.split("\n"),l=[],f=[],m=[],u=[];let g=0;for(let t of h)if(t.startsWith("vn")){const e=t.replace("vn ","").split(" ").map(Number.parseFloat);f.push(...e,1);const i=Math.sqrt(p(e,e));if(console.log(i),p(e,[0,0,1])/i<.5){const t=e.join(",");console.log(!a.get(t)),a.get(t)||a.set(t,g)}g++}else if(t.startsWith("vt")){const e=t.replace("vt ","").split(" ").map(Number.parseFloat);m.push(...e)}else if(t.startsWith("v")){const e=t.replace("v ","").split(" ").map(Number.parseFloat);l.push(...e,1)}else if(t.startsWith("f")){const e=t.replace("f ","").split(" ").map((t=>{const e=t.indexOf("/"),i=t.slice(0,e);return Number.parseInt(i)-1}));u.push(...e)}console.log(a.values());const _=new d(e,i,r,u);if(_.addAttribute("position",l),_.addAttribute("normal",f),0!==m.length){if(!o)throw new Error("This mesh need to a texture path");_.addAttribute("texCoord",m,3);const t=await c.loadImage(o);_.createTex(t,"uTexture")}return _}}const p=(t,e)=>t.reduce(((t,i,r)=>t+i*e[r]),0);class _{ambColor=[0,0,0];ambK=3;difColor=[.3,.3,.3];difK=4;espColor=[1,1,1];espK=3;espExp=20;pos;constructor(t){this.pos=t}createUniforms(t){t.setUniformValue("amb_c",this.ambColor,"3fv"),t.setUniformValue("amb_k",this.ambK,"1f"),t.setUniformValue("dif_c",this.difColor,"3fv"),t.setUniformValue("dif_k",this.difK,"1f"),t.setUniformValue("esp_c",this.espColor,"3fv"),t.setUniformValue("esp_k",this.espK,"1f"),t.setUniformValue("esp_p",this.espExp,"1f")}}class v extends c{#T;async init(t,e=1e3){const i=document.createElement("canvas"),r=i.toDataURL("image/png");[i.width,i.height]=[e,e],await super.init(t,r),this.#T=i}async update(t=(()=>{}),e){t(this.#T.getContext("2d"));const i=this.#T.toDataURL("image/png"),r=await c.loadImage(i);h.changeTex(e,this._tex,r)}}const x=document.querySelector("#game-screen");let w=0;const E=x.getContext("webgl2");E.viewport(0,0,E.canvas.width,E.canvas.height),E.clearColor(0,0,0,1),E.clear(E.COLOR_BUFFER_BIT|E.DEPTH_BUFFER_BIT),async function(t){const e=new c;await e.init(t,"./assets/menu/fundo.jpg");const i=new c;await i.init(t,"./assets/menu/logo_war.png");const r=new c;await r.init(t,"./assets/menu/play_button.png");const o=new c;await o.init(t,"./assets/buttons/Group_17settings_button.png");const s=new c;await s.init(t,"./assets/menu/max_button.png"),e.scaleY=1.85,i.scale=[.35,.56],r.scale=[.15,.26],o.scale=[.05,.08],s.scale=[.05,.08],i.positionY=.25,r.positionY=-.55,o.positionX=.9,o.positionY=.8,s.positionX=.9,s.positionY=.57,t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS),i.draw(),r.draw(),o.draw(),s.draw(),e.draw(),t.disable(t.DEPTH_TEST),x.addEventListener("click",(e=>{const i=function(t,e,i){const r=[t-i.offsetLeft-i.width/2,i.height/2-(e-i.offsetTop)];return[2*r[0]/i.width,2*r[1]/i.height]}(e.clientX,e.clientY,x);r.pointCollision(...i)&&(w=1,async function(t){const e=new c;await e.init(t,"./assets/mapa.jpg"),e.scale=[2.7,2.7];const i=await d.loadMeshFromObj("./assets/meshes/brasil-rotacionado.obj",t,"#version 300 es\n    precision highp float;\n\n    uniform mat4 model;\n    uniform mat4 view;\n    uniform mat4 projection;\n\n    in vec4 position;\n    in vec4 normal;\n\n    out vec4 fPos;\n    out vec4 fColor;\n    out vec4 fNormal;\n\n    void main() {\n        gl_Position = (projection*view*model) * position;\n        gl_Position /= gl_Position.w;\n        fColor = vec4(1.0, 0.0, 0.0, 1.0);\n        fPos = position;\n        fNormal = normal;\n    }\n","#version 300 es\n    precision highp float;\n    \n    uniform mat4 model;\n    uniform mat4 view;\n    uniform mat4 projection;\n\n    uniform vec3 amb_c;\n    uniform vec3 dif_c;\n    uniform vec3 esp_c;\n    uniform vec3 pos;\n    uniform float amb_k;\n    uniform float dif_k;\n    uniform float esp_k;\n    uniform float esp_p;\n\n    in vec4 fColor;\n    in vec4 normal;\n    in vec4 fPos;\n    in vec4 fNormal;\n\n    out vec4 color;\n\n    void main() {\n        mat4 modelView = view*model;\n\n        vec3 lightPos = (view * vec4(pos, 1.0)).xyz;\n        vec3 pos = -(modelView * fPos).xyz;\n\n        vec3 vNormal = normalize(inverse(transpose(modelView)) * fNormal).xyz;\n        vec3 vDistance = normalize(pos - lightPos);\n\n        vec3 normalPos = normalize(pos);\n\n        vec3 halfVector= normalize(vDistance + normalPos);\n\n        vec3 amb = amb_k * amb_c;\n\n        vec3 diff = max(dot(vNormal, vDistance), 0.0) * dif_k * dif_c;\n\n        vec3 spec = max(pow(dot(vNormal, halfVector), esp_p), 0.0) * esp_c * esp_k;\n\n        vec3 color3 = vec3(fColor);\n        \n        color3 = 0.5*color3 + 0.5*(diff + amb + spec);\n\n        color = vec4(color3, 1.0);\n    }\n");i.createVAO(),i.scale=[1.2,1.2,1],i.position=[-0,-0,.3],i.rotation[1]=-.2;const r=new l(x);r.camPosition[2]=1.7,r.camPosition[1]=-.3;const o=new _([1,0,.3]),s=new v;await s.init(t),await s.update((t=>{t instanceof CanvasRenderingContext2D&&(t.fillStyle="white",t.ellipse(500,500,400,500,0,0,2*Math.PI),t.lineWidth=100,t.stroke(),t.font="600px Arial",t.fillText("1",320,600))}),t),s.scale=[.1,.1],s.positionY=.2,i.setUniformValue("view",r.viewMatrix,"Matrix4fv"),i.setUniformValue("projection",r.projMatrix,"Matrix4fv"),o.createUniforms(i),t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS),e.draw(r),i.draw(r),t.disable(t.DEPTH_TEST),s.draw(r)}(t))}))}(E)})();
//# sourceMappingURL=main.bundle.js.map